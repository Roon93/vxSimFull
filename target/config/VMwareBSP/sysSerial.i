ccpentium -mcpu=pentium -march=pentium -ansi  -O2 -fvolatile -nostdlib -fno-builtin -fno-defer-pop -Wall -I/h   -I. -Id:\Tornado2.2\target\config\all -Id:\Tornado2.2\target/h -Id:\Tornado2.2\target/src/config -Id:\Tornado2.2\target/src/drv -DCPU=PENTIUM -DTOOL_FAMILY=gnu -DTOOL=gnu   -E  -c sysSerial.c
# 1 "sysSerial.c"
 

 
# 1 "d:/Tornado2.2/target/h/copyright_wrs.h" 1
 

# 5 "sysSerial.c" 2

 
# 22 "sysSerial.c"

 





# 1 "d:/Tornado2.2/target/h/vxWorks.h" 1
 

 

 
# 53 "d:/Tornado2.2/target/h/vxWorks.h"





































 




 




 





 




 





 









 







 






 




























 





# 1 "d:/Tornado2.2/target/h/types/vxCpu.h" 1
 

 

 








 
# 75 "d:/Tornado2.2/target/h/types/vxCpu.h"

 













 

 










 






























































































# 207 "d:/Tornado2.2/target/h/types/vxCpu.h"




















































# 273 "d:/Tornado2.2/target/h/types/vxCpu.h"










# 296 "d:/Tornado2.2/target/h/types/vxCpu.h"


# 306 "d:/Tornado2.2/target/h/types/vxCpu.h"























 
# 338 "d:/Tornado2.2/target/h/types/vxCpu.h"











# 178 "d:/Tornado2.2/target/h/vxWorks.h" 2
# 1 "d:/Tornado2.2/target/h/types/vxArch.h" 1
 

 

 
# 32 "d:/Tornado2.2/target/h/types/vxArch.h"

 








































































# 1 "d:/Tornado2.2/target/h/arch/i86/archI86.h" 1
 

 
 
# 14 "d:/Tornado2.2/target/h/arch/i86/archI86.h"






















# 60 "d:/Tornado2.2/target/h/arch/i86/archI86.h"


 








# 107 "d:/Tornado2.2/target/h/types/vxArch.h" 2


























 















 











# 179 "d:/Tornado2.2/target/h/vxWorks.h" 2

# 1 "d:/Tornado2.2/target/h/types/vxParams.h" 1
 

 

 
# 15 "d:/Tornado2.2/target/h/types/vxParams.h"

 













































# 181 "d:/Tornado2.2/target/h/vxWorks.h" 2
# 1 "d:/Tornado2.2/target/h/types/vxTypesBase.h" 1
 

 

 
# 24 "d:/Tornado2.2/target/h/types/vxTypesBase.h"

 
















# 1 "d:/Tornado2.2/host/x86-win32/lib/gcc-lib/i586-wrs-vxworks/2.9-PentiumIII-010221/include/stddef.h" 1 3
 
# 19 "d:/Tornado2.2/host/x86-win32/lib/gcc-lib/i586-wrs-vxworks/2.9-PentiumIII-010221/include/stddef.h" 3

 






 








 







 

 




 


 





 



# 91 "d:/Tornado2.2/host/x86-win32/lib/gcc-lib/i586-wrs-vxworks/2.9-PentiumIII-010221/include/stddef.h" 3

 





 


















 





 

 





















typedef long int ptrdiff_t;









 




 

 


































typedef long unsigned int size_t;






















 




 





























 
# 267 "d:/Tornado2.2/host/x86-win32/lib/gcc-lib/i586-wrs-vxworks/2.9-PentiumIII-010221/include/stddef.h" 3

















typedef short unsigned int wchar_t;
























typedef unsigned int wint_t;




 

 

# 346 "d:/Tornado2.2/host/x86-win32/lib/gcc-lib/i586-wrs-vxworks/2.9-PentiumIII-010221/include/stddef.h" 3



 













 








# 43 "d:/Tornado2.2/target/h/types/vxTypesBase.h" 2

 






struct __timer;































































 






 




















 










































































 






















































































































 






 
































# 182 "d:/Tornado2.2/target/h/vxWorks.h" 2
# 1 "d:/Tornado2.2/target/h/types/vxTypes.h" 1
 

 

 
# 17 "d:/Tornado2.2/target/h/types/vxTypes.h"

 
# 56 "d:/Tornado2.2/target/h/types/vxTypes.h"








# 1 "d:/Tornado2.2/target/h/types/vxANSI.h" 1
 

 

 








 
# 25 "d:/Tornado2.2/target/h/types/vxANSI.h"








 










# 1 "d:/Tornado2.2/target/h/types/vxCpu.h" 1
 

 

 








 
# 75 "d:/Tornado2.2/target/h/types/vxCpu.h"

 







# 348 "d:/Tornado2.2/target/h/types/vxCpu.h"

# 45 "d:/Tornado2.2/target/h/types/vxANSI.h" 2
# 1 "d:/Tornado2.2/target/h/types/vxArch.h" 1
 

 

 
# 32 "d:/Tornado2.2/target/h/types/vxArch.h"

 








# 160 "d:/Tornado2.2/target/h/types/vxArch.h"

# 46 "d:/Tornado2.2/target/h/types/vxANSI.h" 2
# 1 "d:/Tornado2.2/target/h/types/vxParams.h" 1
 

 

 
# 15 "d:/Tornado2.2/target/h/types/vxParams.h"

 







# 61 "d:/Tornado2.2/target/h/types/vxParams.h"

# 47 "d:/Tornado2.2/target/h/types/vxANSI.h" 2
# 1 "d:/Tornado2.2/target/h/types/vxTypesBase.h" 1
 

 

 
# 24 "d:/Tornado2.2/target/h/types/vxTypesBase.h"

 








# 376 "d:/Tornado2.2/target/h/types/vxTypesBase.h"

# 48 "d:/Tornado2.2/target/h/types/vxANSI.h" 2







# 65 "d:/Tornado2.2/target/h/types/vxTypes.h" 2


typedef int ssize_t;




typedef unsigned long time_t;




typedef long fpos_t;




typedef signed char int8_t;




typedef unsigned char uint8_t;




typedef short int16_t;




typedef unsigned short uint16_t;




typedef long int32_t;




typedef unsigned long uint32_t;




typedef long long int64_t;




typedef unsigned long long uint64_t;



 

typedef unsigned char	uchar_t;
typedef unsigned short	ushort_t;
typedef unsigned int	uint_t;
typedef unsigned long	ulong_t;

typedef	struct	_quad { long val[2]; } quad;
typedef	long	daddr_t;
typedef	char *	caddr_t;
typedef	char *	addr_t;
typedef	long	swblk_t;

 

typedef short		dev_t;
typedef unsigned short	gid_t;
typedef	unsigned long	ino_t;
typedef int		mode_t;
typedef unsigned long	nlink_t;
typedef long		off_t;
typedef int		pid_t;
typedef unsigned short	uid_t;







# 183 "d:/Tornado2.2/target/h/vxWorks.h" 2
# 1 "d:/Tornado2.2/target/h/types/vxTypesOld.h" 1
 

 

 
# 58 "d:/Tornado2.2/target/h/types/vxTypesOld.h"

 
# 72 "d:/Tornado2.2/target/h/types/vxTypesOld.h"








# 1 "d:/Tornado2.2/target/h/sys/types.h" 1
 

 
 








 
# 31 "d:/Tornado2.2/target/h/sys/types.h"








# 1 "d:/Tornado2.2/target/h/types/vxTypes.h" 1
 

 

 
# 17 "d:/Tornado2.2/target/h/types/vxTypes.h"

 
# 56 "d:/Tornado2.2/target/h/types/vxTypes.h"


# 150 "d:/Tornado2.2/target/h/types/vxTypes.h"

# 40 "d:/Tornado2.2/target/h/sys/types.h" 2







# 81 "d:/Tornado2.2/target/h/types/vxTypesOld.h" 2

 

typedef	char		INT8;
typedef	short		INT16;
typedef	int		INT32;
typedef	long long	INT64;

typedef	unsigned char	UINT8;
typedef	unsigned short	UINT16;
typedef	unsigned int	UINT32;
typedef	unsigned long long UINT64;

typedef	unsigned char	UCHAR;
typedef unsigned short	USHORT;
typedef	unsigned int	UINT;
typedef unsigned long	ULONG;

typedef	int		BOOL;
typedef	int		STATUS;
typedef int 		ARGINT;

typedef void		VOID;







typedef int 		(*FUNCPTR) ();	    
typedef void 		(*VOIDFUNCPTR) ();  
typedef double 		(*DBLFUNCPTR) ();   
typedef float 		(*FLTFUNCPTR) ();   



 




typedef union
    {
    long pm_int;
    void *pm_v;
    const void *pm_cv;
    char *pm_c;
    unsigned char *pm_uc;

    signed char *pm_sc;
    const char *pm_cc;
    const unsigned char *pm_cuc;
    const signed char *pm_csc;
    short *pm_s;
    ushort_t *pm_us;
    const short *pm_cs;
    const ushort_t *pm_cus;
    int *pm_i;
    uint_t *pm_ui;
    const int *pm_ci;
    const uint_t *pm_cui;
    long *pm_l;
    ulong_t *pm_ul;
    const long *pm_cl;
    const ulong_t *pm_cul;

    int8_t *pm_i8;
    uint8_t *pm_ui8;
    const int8_t *pm_ci8;
    const uint8_t *pm_cui8;
    int16_t *pm_i16;
    uint16_t *pm_ui16;
    const int16_t *pm_ci16;
    const uint16_t *pm_cui16;
    int32_t *pm_i32;
    uint32_t *pm_ui32;
    const int32_t *pm_ci32;
    const uint32_t *pm_cui32;








    } pointer_mix_t;













 





 
# 198 "d:/Tornado2.2/target/h/types/vxTypesOld.h"





typedef long	fd_mask;





typedef	struct fd_set
    {
    fd_mask	fds_bits[((unsigned int)(((2048)+(( (sizeof(fd_mask) * 8))-1)))/(unsigned int)( (sizeof(fd_mask) * 8)))];
    } fd_set;







 

typedef	unsigned char	u_char;
typedef	unsigned short	u_short;
typedef	unsigned int	u_int;
typedef	unsigned long	u_long;
typedef	unsigned short	ushort;


 

typedef char		TBOOL;		 


 
















typedef	unsigned char INSTR;		 
























 


# 293 "d:/Tornado2.2/target/h/types/vxTypesOld.h"












# 184 "d:/Tornado2.2/target/h/vxWorks.h" 2













 












 





 

# 1 "d:/Tornado2.2/target/h/tool/gnu/toolMacros.h" 1
 

 

 


















 









 













# 219 "d:/Tornado2.2/target/h/vxWorks.h" 2



 



















# 30 "sysSerial.c" 2
# 1 "d:/Tornado2.2/target/h/iv.h" 1
 

 

 
# 38 "d:/Tornado2.2/target/h/iv.h"

















































# 1 "d:/Tornado2.2/target/h/arch/i86/ivI86.h" 1
 

 

 
# 14 "d:/Tornado2.2/target/h/arch/i86/ivI86.h"









 






















 

 




 




 































# 88 "d:/Tornado2.2/target/h/iv.h" 2




















# 31 "sysSerial.c" 2
# 1 "d:/Tornado2.2/target/h/intLib.h" 1
 

 

 
# 48 "d:/Tornado2.2/target/h/intLib.h"









# 1 "d:/Tornado2.2/target/h/vwModNum.h" 1
 

 

 
# 94 "d:/Tornado2.2/target/h/vwModNum.h"








 











































































































































 











# 58 "d:/Tornado2.2/target/h/intLib.h" 2
# 1 "d:/Tornado2.2/target/h/regs.h" 1
 

 

 
# 41 "d:/Tornado2.2/target/h/regs.h"

















































# 1 "d:/Tornado2.2/target/h/arch/i86/regsI86.h" 1
 

 

 
# 22 "d:/Tornado2.2/target/h/arch/i86/regsI86.h"














typedef struct			 
    {
    ULONG edi;			 
    ULONG esi;			 
    ULONG ebp;			 
    ULONG esp;			 
    ULONG ebx;			 
    ULONG edx;			 
    ULONG ecx;			 
    ULONG eax;			 
    ULONG eflags;		 
    INSTR *pc;			 
    } REG_SET;

typedef struct cpuid		 
    {
    int highestValue;		 
    int vendorId[3];		 
    int signature;		 
    int featuresEbx;		 
    int featuresEcx;		 
    int featuresEdx;		 
    int cacheEax;		 
    int cacheEbx;		 
    int cacheEcx;		 
    int cacheEdx;		 
    int serialNo64[2];		 
    int brandString[12];	 
    } CPUID;

typedef struct mtrr_fix		 
    {
    char type[8];
    } MTRR_FIX;

typedef struct mtrr_var		 
    {
    long long int base;
    long long int mask;
    } MTRR_VAR;

typedef struct mtrr		 
    {
    int cap[2];			 
    int deftype[2];		 
    MTRR_FIX fix[11];		 
    MTRR_VAR var[8];		 
    } MTRR;
typedef MTRR *		MTRR_ID;

typedef struct gdt		 
    {
    unsigned short	limit00;
    unsigned short	base00;
    unsigned char	base01;
    unsigned char	type;
    unsigned char	limit01;
    unsigned char	base02;
    } GDT;

typedef struct tss		 
    {
    UINT16 link;		 
    UINT16 link_pad;
    UINT32 esp0;		 
    UINT16 ss0;			 
    UINT16 ss0_pad;
    UINT32 esp1;		 
    UINT16 ss1;			 
    UINT16 ss1_pad;
    UINT32 esp2;		 
    UINT16 ss2;			 
    UINT16 ss2_pad;
    UINT32 cr3;			 
    INSTR * eip;		 
    UINT32 eflags;		 
    UINT32 eax;			 
    UINT32 ecx;			 
    UINT32 edx;			 
    UINT32 ebx;			 
    UINT32 esp;			 
    UINT32 ebp;			 
    UINT32 esi;			 
    UINT32 edi;			 
    UINT16 es;			 
    UINT16 es_pad;
    UINT16 cs;			 
    UINT16 cs_pad;
    UINT16 ss;			 
    UINT16 ss_pad;
    UINT16 ds;			 
    UINT16 ds_pad;
    UINT16 fs;			 
    UINT16 fs_pad;
    UINT16 gs;			 
    UINT16 gs_pad;
    UINT16 ldt;			 
    UINT16 ldt_pad;
    UINT16 tflag;		 
    UINT16 iomapb;		 
    UINT32 iobmap[32 + 1];
    UINT32 reserved0;		 
    UINT32 reserved1;
    UINT32 reserved2;
    UINT32 reserved3;
    UINT32 reserved4;
    UINT32 reserved5;
    UINT32 reserved6;
    UINT32 reserved7;
    } TSS;

typedef struct segdesc		 
    {
    UINT16	limitLW;	 
    UINT16	baseLW;		 
    UCHAR	baseMB;		 
    UCHAR	type;		 
    UCHAR	limitUB;	 
    UCHAR	baseUB;		 
    } SEGDESC;

typedef struct callGate		 
    {
    UINT16	offsetLo;
    UINT16	selector;
    UCHAR 	params;
    UCHAR 	type;
    UINT16	offsetHi;
    } CALL_GATE;


 














 










 












 












 















 











 














 













 













































 














 

 








 

















































































 
















































































 































































































 







 









 



 









 





 

 










 









 

 











































































 










































































 












 














 










 








 




 






 



 




 




 



 




 



 




 

































 
















# 91 "d:/Tornado2.2/target/h/regs.h" 2















typedef struct regindex
    {
    char	*regName;	 
    int		regOff;		 







    } REG_INDEX;








# 59 "d:/Tornado2.2/target/h/intLib.h" 2


 





 

extern int intCnt;		 


 



 
# 85 "d:/Tornado2.2/target/h/intLib.h"






 



extern STATUS 	intConnect (VOIDFUNCPTR *vector, VOIDFUNCPTR routine,
	       	    	    int parameter);
extern FUNCPTR 	intHandlerCreate (FUNCPTR routine, int parameter);
extern void 	intLockLevelSet (int newLevel);
extern int 	intLockLevelGet (void);
extern BOOL 	intContext (void);
extern int 	intCount (void);
extern void 	intVecBaseSet (FUNCPTR *baseAddr);
extern FUNCPTR *intVecBaseGet (void);
extern void 	intVecSet (FUNCPTR *vector, FUNCPTR function);
extern FUNCPTR 	intVecGet (FUNCPTR *vector);
extern int 	intLevelSet (int level);
extern int 	intLock (void);
extern int 	intUnlock (int oldSR);
extern int 	intRegsLock (REG_SET *pRegs);
extern void 	intRegsUnlock (REG_SET *pRegs, int lockKey);
extern STATUS   intVecTableWriteProtect (void);

























extern int	intDisable (int);
extern int	intEnable (int);







# 1 "d:/Tornado2.2/target/h/arch/i86/intI86Lib.h" 1
 

 

 














 
















extern FUNCPTR 	intHandlerCreateI86 (FUNCPTR routine, int parameter,
				     FUNCPTR routineBoi, int parameterBoi,
				     FUNCPTR routineEoi, int parameterEoi);
extern void 	intVecSet2 (FUNCPTR * vector, FUNCPTR function,
			    int idtGate, int idtSelector);
extern void	intVecGet2 (FUNCPTR * vector, FUNCPTR * pFunction, 
			    int * pIdtGate, int * pIdtSelector);
















# 147 "d:/Tornado2.2/target/h/intLib.h" 2







# 206 "d:/Tornado2.2/target/h/intLib.h"







# 32 "sysSerial.c" 2
# 1 "config.h" 1
 

 

 
# 145 "config.h"

 











 






# 1 "d:/Tornado2.2/target/config/all/configAll.h" 1
 

 

 
# 184 "d:/Tornado2.2/target/config/all/configAll.h"

 








# 1 "d:/Tornado2.2/target/h/smLib.h" 1
 

 
 
# 34 "d:/Tornado2.2/target/h/smLib.h"








 




 

 






 


					 




 






 




 




 



					 




					 





					 




					 
					 








					 

					 








 







 

typedef struct sm_cpu_desc	 
    {
    int		status;		 
    int		intType;	 
    int		intArg1;	 
    int		intArg2;	 
    int		intArg3;	 
    int		reserved1;	 
    int		reserved2;	 
    } SM_CPU_DESC;


 

typedef struct sm_hdr		 
    {
    int		tasType;	 
    int		maxCpus;	 
    int		cpuTable;	 
    int		reserved1;	 
    int		reserved2;	 
    int		reserved3;	 
    int		reserved4;	 
    int		reserved5;	 
    int		reserved6;	 
    int		reserved7;	 
    int		reserved8;	 
    } SM_HDR;


 

typedef struct sm_anchor	 
    {
    UINT	readyValue;      
    int		version;         
    int		masterCpu;       
    int		smHeader;	 
    int		smPktHeader;     
    int 	smObjHeader;     
    int		user1;           
    int		user2;           
    int		reserved1;       
    int		reserved2;       
    int		reserved3;       
    } SM_ANCHOR;

 

typedef struct sm_desc		 
    {
    int		status;		 
    SM_ANCHOR	*anchorLocalAdrs; 
    SM_HDR	*headerLocalAdrs; 
    SM_CPU_DESC	*cpuTblLocalAdrs; 
    int		base;		 
    int		cpuNum;		 
    int		ticksPerBeat;	 
    int		intType;	 
    int		intArg1;	 
    int		intArg2;	 
    int		intArg3;	 
    int		maxCpus;	 
    FUNCPTR	tasRoutine;	 
    FUNCPTR	tasClearRoutine; 
    } SM_DESC;


 

typedef struct sm_info		 
    {
    int		version;	 
    int		tasType;	 
    int		maxCpus;	 
    int		attachedCpus;	 
    } SM_INFO;


 

typedef struct sm_cpu_info	 
    {
    int		cpuNum;		 
    int		status;		 
    int		intType;	 
    int		intArg1;	 
    int		intArg2;	 
    int		intArg3;	 
    } SM_CPU_INFO;

typedef struct sm_region	 
    {
    SM_ANCHOR *	anchor;		 
    } SM_REGION;





 

extern int	smCurMaxTries;     
extern VOIDFUNCPTR smUtilTasClearRtn;
extern FUNCPTR smUtilUser1Rtn;
extern FUNCPTR smUtilUser2Rtn;

 



extern void	smLibInit (void * pRgnCfgTbl, UINT objSize, UINT netSize);
extern STATUS 	smSetup (SM_ANCHOR *anchorLocalAdrs, char *smLocalAdrs,
			 int tasType, int maxCpus, int	* pMemUsed);
extern STATUS	smAttach (SM_DESC *pSmDesc);
extern STATUS 	smDetach (SM_DESC *pSmDesc);
extern void 	smInit (SM_DESC *pSmDesc, SM_ANCHOR *anchorLocalAdrs,
			int ticksPerBeat, int intType, int intArg1,
			int intArg2, int intArg3);
extern BOOL 	smIsAlive (SM_ANCHOR *pAnchor, int *pHeader, int base,
			   int heartBeats, int ticksPerBeat);
extern STATUS 	smLockTake (int * lockLocalAdrs, FUNCPTR tasRoutine,
			   int numTries, int * pOldLvl);
extern void	smLockGive (int *lockLocalAdrs, FUNCPTR tasClearRoutine,
			    int oldLvl);
extern STATUS 	smInfoGet (SM_DESC *pSmDesc, SM_INFO *pInfo);
extern STATUS 	smCpuInfoGet (SM_DESC *pSmDesc, int cpuNum,
			      SM_CPU_INFO *pCpuInfo);



# 276 "d:/Tornado2.2/target/h/smLib.h"









# 195 "d:/Tornado2.2/target/config/all/configAll.h" 2
# 1 "d:/Tornado2.2/target/h/vme.h" 1
 

 

 
# 22 "d:/Tornado2.2/target/h/vme.h"

 
# 33 "d:/Tornado2.2/target/h/vme.h"








 































# 196 "d:/Tornado2.2/target/config/all/configAll.h" 2


 
 
 
 
 








































 
 











 

 















































 






# 327 "d:/Tornado2.2/target/config/all/configAll.h"


 
 
 
 
 


# 426 "d:/Tornado2.2/target/config/all/configAll.h"

 
 
 
 
 






















 
























 


# 490 "d:/Tornado2.2/target/config/all/configAll.h"


# 500 "d:/Tornado2.2/target/config/all/configAll.h"


# 510 "d:/Tornado2.2/target/config/all/configAll.h"











# 529 "d:/Tornado2.2/target/config/all/configAll.h"


# 540 "d:/Tornado2.2/target/config/all/configAll.h"


# 550 "d:/Tornado2.2/target/config/all/configAll.h"












# 570 "d:/Tornado2.2/target/config/all/configAll.h"











# 592 "d:/Tornado2.2/target/config/all/configAll.h"





 



 







 













 



 











 































 








 
 
 
 
 

 




 
 
 
 
 

 








 






 







# 733 "d:/Tornado2.2/target/config/all/configAll.h"

 




 




 




 




 




 








































# 808 "d:/Tornado2.2/target/config/all/configAll.h"


 









 










 





 












 

 
 
 
 
 











 


 
 
 
 
 

# 932 "d:/Tornado2.2/target/config/all/configAll.h"




     



















 


                                          
                                          








 
























 





























 






 


# 1042 "d:/Tornado2.2/target/config/all/configAll.h"

 








 








 


# 1073 "d:/Tornado2.2/target/config/all/configAll.h"

 






 





 












# 166 "config.h" 2
# 1 "pc.h" 1
 

 

 
# 59 "pc.h"

 











# 1 "d:/Tornado2.2/target/h/drv/intrCtl/i8259.h" 1
 

 

 
# 17 "d:/Tornado2.2/target/h/drv/intrCtl/i8259.h"








 




 





 




 


















extern VOID	i8259Init	(void);
extern int	sysIntLevel	(int arg);
extern VOID	sysIntLock	(void);
extern VOID	sysIntUnlock	(void);
extern VOID 	i8259IntBoi 	(int irqNo);
extern VOID 	i8259IntBoiEem	(int irqNo);
extern VOID 	i8259IntBoiSmm	(int irqNo);
extern VOID 	i8259IntEoiSmm	(int irqNo);
extern VOID 	i8259IntEoiMaster (int irqNo);
extern VOID 	i8259IntEoiSlave (int irqNo);
extern VOID 	i8259IntEoiSlaveNfnm (int irqNo);
extern VOID 	i8259IntEoiSlaveSfnm (int irqNo);


# 89 "d:/Tornado2.2/target/h/drv/intrCtl/i8259.h"









# 73 "pc.h" 2
# 1 "d:/Tornado2.2/target/h/drv/timer/i8253.h" 1
 

 

 













 




 





 












# 74 "pc.h" 2
# 1 "d:/Tornado2.2/target/h/drv/timer/mc146818.h" 1
 

 

 


















typedef struct
    {
    int rate;
    char bits;
    } CLK_RATE;




 






 





 










 






 










# 75 "pc.h" 2
# 1 "d:/Tornado2.2/target/h/drv/timer/timerDev.h" 1
 

 

 








 











 




extern	STATUS	sysClkConnect (FUNCPTR routine, int arg);
extern	void	sysClkDisable (void);
extern	void	sysClkEnable (void);
extern	int	sysClkRateGet (void);
extern	STATUS	sysClkRateSet (int ticksPerSecond);
extern	STATUS	sysAuxClkConnect (FUNCPTR routine, int arg);
extern	void	sysAuxClkDisable (void);
extern	void	sysAuxClkEnable (void);
extern	int	sysAuxClkRateGet (void);
extern	STATUS	sysAuxClkRateSet (int ticksPerSecond);
extern	STATUS	sysTimestampConnect (FUNCPTR routine, int arg);
extern	STATUS	sysTimestampEnable (void);
extern	STATUS	sysTimestampDisable (void);
extern	UINT32	sysTimestampFreq (void);
extern	UINT32	sysTimestampPeriod (void);
extern	UINT32	sysTimestamp (void);
extern	UINT32	sysTimestampLock (void);



# 72 "d:/Tornado2.2/target/h/drv/timer/timerDev.h"









# 76 "pc.h" 2
# 1 "d:/Tornado2.2/target/h/drv/timer/timestampDev.h" 1
 

 

 







 






# 77 "pc.h" 2
# 1 "d:/Tornado2.2/target/h/drv/fdisk/nec765Fd.h" 1
 

 
 
# 16 "d:/Tornado2.2/target/h/drv/fdisk/nec765Fd.h"











# 1 "d:/Tornado2.2/target/h/blkIo.h" 1
 

 

 
# 21 "d:/Tornado2.2/target/h/blkIo.h"










typedef struct		 
    {
    FUNCPTR		bd_blkRd;		 
    FUNCPTR		bd_blkWrt;		 
    FUNCPTR		bd_ioctl;		 
    FUNCPTR		bd_reset;		 
    FUNCPTR		bd_statusChk;		 
    BOOL		bd_removable;		 
    ULONG		bd_nBlocks;		 
    ULONG		bd_bytesPerBlk;		 
    ULONG		bd_blksPerTrack;	 
    ULONG		bd_nHeads;		 
    int			bd_retry;		 
    int			bd_mode;		 
    BOOL		bd_readyChanged;	 
    } BLK_DEV;







# 28 "d:/Tornado2.2/target/h/drv/fdisk/nec765Fd.h" 2

typedef struct fdDev
    {
    BLK_DEV blkDev;
    int fdType;		 
    int drive;		 
    int blkOffset;	 
    } FD_DEV;

typedef struct fdType
    {
    int sectors;	 
    int sectorsTrack;	 
    int heads;		 
    int cylinders;	 
    int secSize;	 
    char gap1;		 
    char gap2;		 
    char dataRate;	 
    char stepRate;	 
    char headUnload;	 
    char headLoad;	 
    char mfm;		 
    char sk;		 
    char *name;		 
    } FD_TYPE;

typedef struct fdRaw
    {				 
    UINT cylinder;		 
    UINT head;			 
    UINT sector;			 
    char *pBuf;			 
    UINT nSecs;			 
    UINT direction;		 
    } FD_RAW;


 



 






 








 











 










 


















 




 



STATUS		fdDrv		(int vector, int level);
BLK_DEV		*fdDevCreate	(int fdType, int drive, int nBlks, int offset);
STATUS		fdRawio		(int drive, int fdType, FD_RAW *pFdRaw);
STATUS		usrFdConfig	(int type, int drive, char *fileName);



















# 78 "pc.h" 2
# 1 "d:/Tornado2.2/target/h/drv/serial/pcConsole.h" 1
 

 

 
# 14 "d:/Tornado2.2/target/h/drv/serial/pcConsole.h"










# 1 "d:/Tornado2.2/target/h/tyLib.h" 1
 

 

 
# 53 "d:/Tornado2.2/target/h/tyLib.h"








# 1 "d:/Tornado2.2/target/h/iosLib.h" 1
 

 

 
# 36 "d:/Tornado2.2/target/h/iosLib.h"









# 1 "d:/Tornado2.2/target/h/ioLib.h" 1
 

 

 
# 89 "d:/Tornado2.2/target/h/ioLib.h"









# 1 "d:/Tornado2.2/target/h/limits.h" 1
 

 

 
# 17 "d:/Tornado2.2/target/h/limits.h"










 








# 1 "d:/Tornado2.2/target/h/tool/gnu/limits.h" 1



 



 



 




 





 



 












 

 




 



 








 



 













 




# 96 "d:/Tornado2.2/target/h/tool/gnu/limits.h"




# 37 "d:/Tornado2.2/target/h/limits.h" 2


































# 99 "d:/Tornado2.2/target/h/ioLib.h" 2
# 1 "d:/Tornado2.2/target/h/net/uio.h" 1
 

 

 
# 39 "d:/Tornado2.2/target/h/net/uio.h"

 





















struct iovec {
	caddr_t	iov_base;
	int	iov_len;
};

enum	uio_rw { UIO_READ, UIO_WRITE };

 
enum uio_seg {
	UIO_USERSPACE,		 
	UIO_SYSSPACE,		 
	UIO_USERISPACE		 
};

struct uio {
	struct	iovec *uio_iov;
	int	uio_iovcnt;
	off_t	uio_offset;
	int	uio_resid;
	enum	uio_seg uio_segflg;
	enum	uio_rw uio_rw;



};
















# 100 "d:/Tornado2.2/target/h/ioLib.h" 2
# 1 "d:/Tornado2.2/target/h/fcntl.h" 1
 

 

 
# 15 "d:/Tornado2.2/target/h/fcntl.h"









# 1 "d:/Tornado2.2/target/h/sys/fcntlcom.h" 1
 

 
 





 

















 























 









 












 









 










 










 


 



















 









 
struct flock {
	short	l_type;		 
	short	l_whence;	 
	long	l_start;	 
	long	l_len;		 
	short	l_pid;		 
	short	l_xxx;		 
};


 
struct eflock {
	short	l_type;		 
	short	l_whence;	 
	long	l_start;	 
	long	l_len;		 
	short	l_pid;		 
	short	l_xxx;		 
	long	l_rpid;		 
	long	l_rsys;		 
};



 







# 25 "d:/Tornado2.2/target/h/fcntl.h" 2





extern int      open (const char *name, int flags, int mode );
extern int      creat (const char *name, int mode );














# 101 "d:/Tornado2.2/target/h/ioLib.h" 2
# 1 "d:/Tornado2.2/target/h/unistd.h" 1
 

 

 
# 20 "d:/Tornado2.2/target/h/unistd.h"
















 









 



extern STATUS 		unlink (char *name);
extern STATUS 		close (int fd);
extern int 		read (int fd, char *buffer, size_t maxbytes);
extern int 		write (int fd, char *buffer, size_t nbytes);
extern int 		lseek (int fd, long offset, int whence);
extern STATUS 		chdir (char *pathname);
extern STATUS 		pause (void);
extern BOOL 		isatty (int fd);
extern STATUS 		rmdir (const char *dirName);
extern char *		getcwd (char *buffer, int size);
extern int    		ftruncate (int fildes, off_t length);
extern unsigned int	sleep (unsigned int);
extern unsigned int	alarm (unsigned int);


# 79 "d:/Tornado2.2/target/h/unistd.h"







# 102 "d:/Tornado2.2/target/h/ioLib.h" 2









 















 




















































 










 


 


















 








 









 

 

typedef struct		 
    {
    int entryNum;		 
    char name[(255 + 1)];	 
    int nChars;			 
    short day;			 
    short month;		 
    short year;			 
    } REQ_DIR_ENTRY;

 
						 
typedef struct
    {
    ULONG  inode;		 
    char * fileName;		 
    } INODE_TO_NAME_IOCTL;
					 
 













 

extern int ioMaxLinkLevels;	 
						 
 







extern STATUS 	ioFullFileNameGet ();

extern STATUS 	ioDefPathCat (char *name);
extern STATUS 	ioDefPathSet (char *name);
extern char *	getwd (char *pathname);
extern int 	ioGlobalStdGet (int stdFd);
extern int 	ioTaskStdGet (int taskId, int stdFd);
extern int 	ioctl (int fd, int function, int arg);
extern int      readv (int fd, struct iovec *iov, int iovcnt);
extern void 	ioDefDevGet (char *devName);
extern void 	ioDefDirGet (char *dirName);
extern void 	ioDefPathGet (char *pathname);
extern void 	ioGlobalStdSet (int stdFd, int newFd);
extern void 	ioTaskStdSet (int taskId, int stdFd, int newFd);
extern int      writev (int fd, struct iovec *iov, int iovcnt);


# 314 "d:/Tornado2.2/target/h/ioLib.h"


 









 


















# 46 "d:/Tornado2.2/target/h/iosLib.h" 2
# 1 "d:/Tornado2.2/target/h/dllLib.h" 1
 

 

 
# 20 "d:/Tornado2.2/target/h/dllLib.h"









 

typedef struct dlnode		 
    {
    struct dlnode *next;	 
    struct dlnode *previous;	 
    } DL_NODE;


 

typedef struct			 
    {
    DL_NODE *head;	 
    DL_NODE *tail;	 
    } DL_LIST;

 

 
# 61 "d:/Tornado2.2/target/h/dllLib.h"






 
# 79 "d:/Tornado2.2/target/h/dllLib.h"






 
# 97 "d:/Tornado2.2/target/h/dllLib.h"






 
# 115 "d:/Tornado2.2/target/h/dllLib.h"






 
# 131 "d:/Tornado2.2/target/h/dllLib.h"







 



extern DL_LIST *dllCreate (void);
extern DL_NODE *dllEach (DL_LIST *pList, FUNCPTR routine, int routineArg);
extern DL_NODE *dllGet (DL_LIST *pList);
extern STATUS 	dllDelete (DL_LIST *pList);
extern STATUS 	dllInit (DL_LIST *pList);
extern STATUS 	dllTerminate (DL_LIST *pList);
extern int 	dllCount (DL_LIST *pList);
extern void 	dllAdd (DL_LIST *pList, DL_NODE *pNode);
extern void 	dllInsert (DL_LIST *pList, DL_NODE *pPrev, DL_NODE *pNode);
extern void 	dllRemove (DL_LIST *pList, DL_NODE *pNode);


# 167 "d:/Tornado2.2/target/h/dllLib.h"






# 47 "d:/Tornado2.2/target/h/iosLib.h" 2


 









typedef struct 		 
    {
    DL_NODE	node;		 
    short	drvNum;		 
    char *	name;		 
    } DEV_HDR;


 




extern STATUS 	iosInit (int max_drivers, int max_files, char *nullDevName);
extern void 	iosShowInit (void);
extern DEV_HDR *iosDevFind (char *name, char ** pNameTail);
extern DEV_HDR *iosFdDevFind (int fd);
extern DEV_HDR *iosNextDevGet (DEV_HDR *pDev);
extern STATUS 	iosClose (int fd);
extern STATUS 	iosDevAdd (DEV_HDR *pDevHdr, char *name, int drvnum);
extern STATUS 	iosDrvRemove (int drvnum, BOOL forceClose);
extern int 	iosCreate (DEV_HDR *pDevHdr, char *fileName, int mode);
extern int 	iosDelete (DEV_HDR *pDevHdr, char *fileName);
extern int 	iosDrvInstall (FUNCPTR pCreate, FUNCPTR pDelete, FUNCPTR pOpen,
			       FUNCPTR pClose, FUNCPTR pRead, FUNCPTR pWrite,
			       FUNCPTR pIoctl);
extern int 	iosFdNew (DEV_HDR *pDevHdr, char *name, int value);
extern int 	iosFdValue (int fd);
extern int 	iosIoctl (int fd, int function, int arg);
extern int 	iosOpen (DEV_HDR *pDevHdr, char *fileName, int flags, int mode);
extern int 	iosRead (int fd, char *buffer, int maxbytes);
extern int 	iosWrite (int fd, char *buffer, int nbytes);
extern void 	iosDevDelete (DEV_HDR *pDevHdr);
extern void 	iosDevShow (void);
extern void 	iosDrvShow (void);
extern void 	iosFdFree (int fd);
extern STATUS 	iosFdSet (int fd, DEV_HDR *pDevHdr, char *name, int value);
extern void 	iosFdShow (void);


# 125 "d:/Tornado2.2/target/h/iosLib.h"







# 62 "d:/Tornado2.2/target/h/tyLib.h" 2
# 1 "d:/Tornado2.2/target/h/rngLib.h" 1
 

 

 
# 29 "d:/Tornado2.2/target/h/rngLib.h"









 

 

typedef struct		 
    {
    int pToBuf;		 
    int pFromBuf;	 
    int bufSize;	 
    char *buf;		 
    } RING;

 

typedef RING *RING_ID;


 








 
# 75 "d:/Tornado2.2/target/h/rngLib.h"


# 88 "d:/Tornado2.2/target/h/rngLib.h"

 
# 100 "d:/Tornado2.2/target/h/rngLib.h"


# 127 "d:/Tornado2.2/target/h/rngLib.h"

 



extern BOOL 	rngIsEmpty (RING_ID ringId);
extern BOOL 	rngIsFull (RING_ID ringId);
extern RING_ID 	rngCreate (int nbytes);
extern int 	rngBufGet (RING_ID rngId, char *buffer, int maxbytes);
extern int 	rngBufPut (RING_ID rngId, char *buffer, int nbytes);
extern int 	rngFreeBytes (RING_ID ringId);
extern int 	rngNBytes (RING_ID ringId);
extern void 	rngDelete (RING_ID ringId);
extern void 	rngFlush (RING_ID ringId);
extern void 	rngMoveAhead (RING_ID ringId, int n);
extern void 	rngPutAhead (RING_ID ringId, char byte, int offset);


# 159 "d:/Tornado2.2/target/h/rngLib.h"







# 63 "d:/Tornado2.2/target/h/tyLib.h" 2
# 1 "d:/Tornado2.2/target/h/selectLib.h" 1
 

 

 
# 32 "d:/Tornado2.2/target/h/selectLib.h"









# 1 "d:/Tornado2.2/target/h/sys/times.h" 1
 

 

 
# 23 "d:/Tornado2.2/target/h/sys/times.h"












 




struct timeval
    {
    long tv_sec;	 
    long tv_usec;	 
    };

struct timezone
    {
    int	tz_minuteswest;	 
    int	tz_dsttime;	 
    };













# 42 "d:/Tornado2.2/target/h/selectLib.h" 2

 





typedef enum
    {
    SELREAD,
    SELWRITE
    } SELECT_TYPE;

# 1 "d:/Tornado2.2/target/h/private/selectLibP.h" 1
 

 

 













# 1 "d:/Tornado2.2/target/h/lstLib.h" 1
 

 

 
# 28 "d:/Tornado2.2/target/h/lstLib.h"












 

typedef struct node		 
    {
    struct node *next;		 
    struct node *previous;	 
    } NODE;


 

typedef struct			 
    {
    NODE node;			 
    int count;			 
    } LIST;

 


 




extern void	lstLibInit (void);
extern NODE *	lstFirst (LIST *pList);
extern NODE *	lstGet (LIST *pList);
extern NODE *	lstLast (LIST *pList);
extern NODE *	lstNStep (NODE *pNode, int nStep);
extern NODE *	lstNext (NODE *pNode);
extern NODE *	lstNth (LIST *pList, int nodenum);
extern NODE *	lstPrevious (NODE *pNode);
extern int 	lstCount (LIST *pList);
extern int 	lstFind (LIST *pList, NODE *pNode);
extern void 	lstAdd (LIST *pList, NODE *pNode);
extern void 	lstConcat (LIST *pDstList, LIST *pAddList);
extern void 	lstDelete (LIST *pList, NODE *pNode);
extern void 	lstExtract (LIST *pSrcList, NODE *pStartNode, NODE *pEndNode,
	  		    LIST *pDstList);
extern void 	lstFree (LIST *pList);
extern void 	lstInit (LIST *pList);
extern void 	lstInsert (LIST *pList, NODE *pPrev, NODE *pNode);


# 105 "d:/Tornado2.2/target/h/lstLib.h"









# 20 "d:/Tornado2.2/target/h/private/selectLibP.h" 2
# 1 "d:/Tornado2.2/target/h/private/semLibP.h" 1
 

 

 
# 20 "d:/Tornado2.2/target/h/private/semLibP.h"










# 1 "d:/Tornado2.2/target/h/vwModNum.h" 1
 

 

 
# 94 "d:/Tornado2.2/target/h/vwModNum.h"


# 253 "d:/Tornado2.2/target/h/vwModNum.h"

# 31 "d:/Tornado2.2/target/h/private/semLibP.h" 2
# 1 "d:/Tornado2.2/target/h/semLib.h" 1
 

 

 
# 34 "d:/Tornado2.2/target/h/semLib.h"









# 1 "d:/Tornado2.2/target/h/vwModNum.h" 1
 

 

 
# 94 "d:/Tornado2.2/target/h/vwModNum.h"


# 253 "d:/Tornado2.2/target/h/vwModNum.h"

# 44 "d:/Tornado2.2/target/h/semLib.h" 2

 






 











 

typedef enum		 
    {
    SEM_EMPTY,			 
    SEM_FULL			 
    } SEM_B_STATE;

typedef struct semaphore *SEM_ID;

 



extern STATUS 	semGive (SEM_ID semId);
extern STATUS 	semTake (SEM_ID semId, int timeout);
extern STATUS 	semFlush (SEM_ID semId);
extern STATUS 	semDelete (SEM_ID semId);
extern int 	semInfo (SEM_ID semId, int idList[], int maxTasks);
extern STATUS 	semBLibInit (void);
extern SEM_ID 	semBCreate (int options, SEM_B_STATE initialState);
extern STATUS 	semCLibInit (void);
extern SEM_ID 	semCCreate (int options, int initialCount);
extern STATUS 	semMLibInit (void);
extern SEM_ID 	semMCreate (int options);
extern STATUS   semMGiveForce (SEM_ID semId);
extern STATUS 	semOLibInit (void);
extern SEM_ID 	semCreate (void);
extern void 	semShowInit (void);
extern STATUS 	semShow (SEM_ID semId, int level);


# 115 "d:/Tornado2.2/target/h/semLib.h"








# 32 "d:/Tornado2.2/target/h/private/semLibP.h" 2
# 1 "d:/Tornado2.2/target/h/qLib.h" 1
 

 

 
# 28 "d:/Tornado2.2/target/h/qLib.h"









# 1 "d:/Tornado2.2/target/h/vwModNum.h" 1
 

 

 
# 94 "d:/Tornado2.2/target/h/vwModNum.h"


# 253 "d:/Tornado2.2/target/h/vwModNum.h"

# 38 "d:/Tornado2.2/target/h/qLib.h" 2
# 1 "d:/Tornado2.2/target/h/qClass.h" 1
 

 

 
# 22 "d:/Tornado2.2/target/h/qClass.h"












 

typedef struct q_class		 
    {
    FUNCPTR createRtn;		 
    FUNCPTR initRtn;		 
    FUNCPTR deleteRtn;		 
    FUNCPTR terminateRtn;	 
    FUNCPTR putRtn;		 
    FUNCPTR getRtn;		 
    FUNCPTR removeRtn;		 
    FUNCPTR resortRtn;		 
    FUNCPTR advanceRtn;		 
    FUNCPTR getExpiredRtn;	 
    FUNCPTR keyRtn;		 
    FUNCPTR calibrateRtn;	 
    FUNCPTR infoRtn;		 
    FUNCPTR eachRtn;		 
    struct q_class *valid;	 
    } Q_CLASS;

typedef Q_CLASS *Q_CLASS_ID;	 

 

 
# 70 "d:/Tornado2.2/target/h/qClass.h"

















# 39 "d:/Tornado2.2/target/h/qLib.h" 2

 





 

extern Q_CLASS_ID		qFifoClassId;
extern Q_CLASS_ID		qPriListClassId;
extern Q_CLASS_ID		qPriListFromTailClassId;
extern Q_CLASS_ID		qPriDeltaClassId;
extern Q_CLASS_ID		qPriHeapClassId;
extern Q_CLASS_ID		qPriBMapClassId;

 








 

 








typedef struct		 
    {
    UINT     qPriv1;			 
    UINT     qPriv2;			 
    UINT     qPriv3;			 
    UINT     qPriv4;			 
    } Q_NODE;


 








typedef struct		 
    {
    Q_NODE  *pFirstNode;		 
    UINT     qPriv1;			 
    UINT     qPriv2;			 
    Q_CLASS *pQClass;			 
    } Q_HEAD;





 


 
# 121 "d:/Tornado2.2/target/h/qLib.h"




 
# 134 "d:/Tornado2.2/target/h/qLib.h"





 
# 152 "d:/Tornado2.2/target/h/qLib.h"





 












 
# 179 "d:/Tornado2.2/target/h/qLib.h"





 
# 194 "d:/Tornado2.2/target/h/qLib.h"





 
# 215 "d:/Tornado2.2/target/h/qLib.h"





 
# 232 "d:/Tornado2.2/target/h/qLib.h"





 
# 246 "d:/Tornado2.2/target/h/qLib.h"





 
# 266 "d:/Tornado2.2/target/h/qLib.h"





 
# 290 "d:/Tornado2.2/target/h/qLib.h"







extern Q_HEAD *	qCreate (Q_CLASS *pQClass, ...);
extern Q_NODE *	qEach (Q_HEAD *pQHead, FUNCPTR routine, int routineArg);
extern Q_NODE *	qFirst (Q_HEAD *pQHead);
extern Q_NODE *	qGet (Q_HEAD *pQHead);
extern Q_NODE *	qGetExpired (Q_HEAD *pQHead);
extern STATUS 	qDelete (Q_HEAD *pQHead);
extern STATUS 	qInit (Q_HEAD *pQHead, Q_CLASS *pQClass, ...);
extern STATUS 	qTerminate (Q_HEAD *pQHead);
extern ULONG 	qKey (Q_HEAD *pQHead, Q_NODE *pQNode, int keyType);
extern int 	qInfo (Q_HEAD *pQHead, Q_NODE *nodeArray [ ], int maxNodes);
extern void 	qAdvance (Q_HEAD *pQHead);
extern void 	qCalibrate (Q_HEAD *pQHead, ULONG keyDelta);
extern void 	qPut (Q_HEAD *pQHead, Q_NODE *pQNode, ULONG key);
extern STATUS 	qRemove (Q_HEAD *pQHead, Q_NODE *pQNode);
extern void 	qResort (Q_HEAD *pQHead, Q_NODE *pQNode, ULONG newKey);


# 332 "d:/Tornado2.2/target/h/qLib.h"









# 33 "d:/Tornado2.2/target/h/private/semLibP.h" 2
# 1 "d:/Tornado2.2/target/h/private/classLibP.h" 1
 

 
 
# 13 "d:/Tornado2.2/target/h/private/classLibP.h"










# 1 "d:/Tornado2.2/target/h/vwModNum.h" 1
 

 

 
# 94 "d:/Tornado2.2/target/h/vwModNum.h"


# 253 "d:/Tornado2.2/target/h/vwModNum.h"

# 24 "d:/Tornado2.2/target/h/private/classLibP.h" 2
# 1 "d:/Tornado2.2/target/h/memLib.h" 1
 

 

 
# 49 "d:/Tornado2.2/target/h/memLib.h"









# 1 "d:/Tornado2.2/target/h/vwModNum.h" 1
 

 

 
# 94 "d:/Tornado2.2/target/h/vwModNum.h"


# 253 "d:/Tornado2.2/target/h/vwModNum.h"

# 59 "d:/Tornado2.2/target/h/memLib.h" 2

 







 



typedef struct mem_part *PART_ID;

 

typedef struct
    {

    unsigned long numBytesFree,	    
		  numBlocksFree,    
		  maxBlockSizeFree, 
		  numBytesAlloc,    
		  numBlocksAlloc;   

    }  MEM_PART_STATS;


 

 



 




 




 






 









 

 

extern PART_ID memSysPartId;

 

extern FUNCPTR  smMemPartOptionsSetRtn;
extern FUNCPTR  smMemPartFindMaxRtn;
extern FUNCPTR  smMemPartReallocRtn;
extern FUNCPTR  smMemPartShowRtn;

 



extern STATUS 	memInit (char *pPool, unsigned poolSize);
extern STATUS 	memPartLibInit (char *pPool, unsigned poolSize);
extern PART_ID 	memPartCreate (char *pPool, unsigned poolSize);
extern void 	memPartInit (PART_ID partId, char *pPool, unsigned poolSize);
extern STATUS 	memPartAddToPool (PART_ID partId, char *pPool,
				  unsigned poolSize);
extern void 	memAddToPool (char *pPool, unsigned poolSize);
extern void *	memPartAlloc (PART_ID partId, unsigned nBytes);
extern void *   memPartAlignedAlloc (PART_ID partId, unsigned nBytes,
				     unsigned alignment);
extern void *	memalign (unsigned alignment, unsigned size);
extern void *   valloc (unsigned size);
extern STATUS 	memPartFree (PART_ID partId, char *pBlock);
extern STATUS 	memPartOptionsSet (PART_ID partId, unsigned options);
extern int 	memFindMax (void);
extern int 	memPartFindMax (PART_ID partId);
extern void *	memPartRealloc (PART_ID partId, char *pBlock, unsigned nBytes);
extern void 	memOptionsSet (unsigned options);
extern STATUS 	cfree (char *pBlock);
extern void 	memShowInit (void);
extern void 	memShow (int type);
extern STATUS 	memPartShow (PART_ID partId, int type);
extern STATUS   memPartInfoGet (PART_ID	partId, MEM_PART_STATS * ppartStats);


# 187 "d:/Tornado2.2/target/h/memLib.h"









# 25 "d:/Tornado2.2/target/h/private/classLibP.h" 2
# 1 "d:/Tornado2.2/target/h/classLib.h" 1
 

 

 
# 21 "d:/Tornado2.2/target/h/classLib.h"









# 1 "d:/Tornado2.2/target/h/vwModNum.h" 1
 

 

 
# 94 "d:/Tornado2.2/target/h/vwModNum.h"


# 253 "d:/Tornado2.2/target/h/vwModNum.h"

# 31 "d:/Tornado2.2/target/h/classLib.h" 2
# 1 "d:/Tornado2.2/target/h/objLib.h" 1
 

 

 
# 33 "d:/Tornado2.2/target/h/objLib.h"









# 1 "d:/Tornado2.2/target/h/errno.h" 1
 

 

 







 
# 36 "d:/Tornado2.2/target/h/errno.h"










 








































 



 

	 












	 


















 






 



 










 


 




 




extern int *	__errno(void);






# 176 "d:/Tornado2.2/target/h/errno.h"














# 43 "d:/Tornado2.2/target/h/objLib.h" 2
# 1 "d:/Tornado2.2/target/h/vwModNum.h" 1
 

 

 
# 94 "d:/Tornado2.2/target/h/vwModNum.h"


# 253 "d:/Tornado2.2/target/h/vwModNum.h"

# 44 "d:/Tornado2.2/target/h/objLib.h" 2


 









 

typedef struct obj_core  *OBJ_ID;		 


 
# 75 "d:/Tornado2.2/target/h/objLib.h"


# 91 "d:/Tornado2.2/target/h/objLib.h"


 



extern STATUS 	objShow (OBJ_ID objId, int showType);















# 32 "d:/Tornado2.2/target/h/classLib.h" 2


 






typedef struct obj_class *CLASS_ID;		 

extern CLASS_ID classClassId;			 

 



extern STATUS 	classLibInit (void);
extern STATUS 	classMemPartIdSet (CLASS_ID classId, PART_ID memPartId);
extern void 	classShowInit (void);
extern STATUS 	classShow (CLASS_ID classId, int level);


















# 26 "d:/Tornado2.2/target/h/private/classLibP.h" 2
# 1 "d:/Tornado2.2/target/h/private/objLibP.h" 1
 

 

 
















# 1 "d:/Tornado2.2/target/h/objLib.h" 1
 

 

 
# 33 "d:/Tornado2.2/target/h/objLib.h"


# 112 "d:/Tornado2.2/target/h/objLib.h"

# 23 "d:/Tornado2.2/target/h/private/objLibP.h" 2









typedef struct obj_core		 
    {
    struct obj_class *pObjClass;	 
    } OBJ_CORE;






 



extern OBJ_ID 	objCreate (CLASS_ID classId, ...);
extern STATUS 	objInit (CLASS_ID classId, OBJ_ID objId, ...);
extern STATUS 	objDelete (OBJ_ID objId);
extern STATUS 	objDestroy (OBJ_ID objId, BOOL dealloc, int timeout);
extern STATUS 	objFree (CLASS_ID classId, char *pObject);
extern STATUS 	objTerminate (OBJ_ID objId);
extern void *	objAlloc (CLASS_ID classId);
extern void *	objAllocExtra (CLASS_ID classId, unsigned nExtraBytes,
			       void ** ppExtra);
extern void 	objCoreInit (OBJ_CORE *pObjCore, CLASS_ID pObjClass);
extern void 	objCoreTerminate (OBJ_CORE *pObjCore);


# 72 "d:/Tornado2.2/target/h/private/objLibP.h"









# 27 "d:/Tornado2.2/target/h/private/classLibP.h" 2

 









typedef struct obj_class	 
    {
    OBJ_CORE		objCore;	 
    struct mem_part	*objPartId;	 
    unsigned		objSize;	 
    unsigned		objAllocCnt;	 
    unsigned		objFreeCnt;	 
    unsigned		objInitCnt;	 
    unsigned		objTerminateCnt; 
    int			coreOffset;	 
    FUNCPTR		createRtn;	 
    FUNCPTR		initRtn;	 
    FUNCPTR		destroyRtn;	 
    FUNCPTR		showRtn;	 
    FUNCPTR		instRtn;	 
    } OBJ_CLASS;


 



extern CLASS_ID	classCreate (unsigned objectSize, int coreOffset,
			     FUNCPTR createRtn, FUNCPTR initRtn,
			     FUNCPTR destroyRtn);
extern STATUS	classInit (OBJ_CLASS *pObjClass, unsigned objectSize,
			   int coreOffset, FUNCPTR createRtn, FUNCPTR initRtn,
			   FUNCPTR destroyRtn);
extern STATUS	classDestroy (CLASS_ID classId);
extern STATUS	classInstConnect (CLASS_ID classId, FUNCPTR instRtn);
extern STATUS	classShowConnect (CLASS_ID classId, FUNCPTR showRtn);
extern STATUS   classInstrument ( OBJ_CLASS * pObjClass, 
				  OBJ_CLASS * pObjInstClass );



# 83 "d:/Tornado2.2/target/h/private/classLibP.h"








   







# 34 "d:/Tornado2.2/target/h/private/semLibP.h" 2

# 1 "d:/Tornado2.2/target/h/private/eventLibP.h" 1
 

 

 






















extern VOIDFUNCPTR eventEvtRtn;  

 

typedef struct eventsCb
    {
    UINT32 wanted;	 
    volatile UINT32 received;	 
    UINT8  options;	 
    UINT8  sysflags;	 
    UINT8  pad[2];	 
    } EVENTS;		 

 



 




 

typedef struct eventsResourceCb
    {
    UINT32 registered;	 
    int    taskId;	 
    UINT8  options;	 
    UINT8  pad[3];	 
    } EVENTS_RSRC;	 





 














extern void 	eventLibInit	(void);
extern void 	eventInit	(EVENTS_RSRC * pEvRsrc);
extern void 	eventTerminate 	(const EVENTS_RSRC * pEvRsrc);
extern void 	semEvLibInit	(void);
extern void 	msgQEvLibInit	(void);
extern STATUS 	eventStart	(OBJ_ID objId, EVENTS_RSRC * pEvRsrc,
				 FUNCPTR isRsrcFree, UINT32 events,
				 UINT8 options);
extern STATUS	eventRsrcSend	(int taskId, UINT32 events);
extern STATUS	eventRsrcShow	(EVENTS_RSRC * pEvRsrc);
extern STATUS   eventTaskShow	(EVENTS	* pEvents);


# 104 "d:/Tornado2.2/target/h/private/eventLibP.h"
















# 36 "d:/Tornado2.2/target/h/private/semLibP.h" 2





 













typedef struct semaphore  
    {
    OBJ_CORE	objCore;	 
    UINT8	semType;	 
    UINT8	options;	 
    UINT16	recurse;	 
    Q_HEAD	qHead;		 
    union
	{
	UINT		 count;	 
	struct windTcb	*owner;	 
	} state;
    EVENTS_RSRC	events;		 

    } SEMAPHORE;




 
# 84 "d:/Tornado2.2/target/h/private/semLibP.h"



 
# 97 "d:/Tornado2.2/target/h/private/semLibP.h"







 

extern OBJ_CLASS	semClass;		 
extern OBJ_CLASS	semInstClass;		 
extern CLASS_ID		semClassId;		 
extern CLASS_ID		semInstClassId;		 
extern FUNCPTR		semGiveTbl [];		 
extern FUNCPTR		semTakeTbl [];		 
extern FUNCPTR		semFlushTbl [];		 
extern FUNCPTR		semGiveDeferTbl [];	 
extern FUNCPTR		semFlushDeferTbl [];	 
extern int		semMGiveKernWork;	 

extern FUNCPTR  semSmShowRtn;	 
extern FUNCPTR  semSmInfoRtn;	 

 



extern STATUS	semLibInit (void);
extern STATUS	semTerminate (SEM_ID semId);
extern STATUS	semDestroy (SEM_ID semId, BOOL dealloc);
extern STATUS	semGiveDefer (SEM_ID semId);
extern STATUS	semFlushDefer (SEM_ID semId);
extern STATUS	semInvalid (SEM_ID semId);
extern STATUS	semIntRestrict (SEM_ID semId);
extern STATUS	semQInit (SEMAPHORE *pSemaphore, int options);
extern STATUS	semQFlush (SEM_ID semId);
extern void	semQFlushDefer (SEM_ID semId);
extern STATUS	semBInit (SEMAPHORE *pSem,int options,SEM_B_STATE initialState);
extern STATUS	semBCoreInit (SEMAPHORE *pSemaphore, int options,
			      SEM_B_STATE initialState);
extern STATUS	semBGive (SEM_ID semId);
extern STATUS	semBTake (SEM_ID semId, int timeout);
extern void	semBGiveDefer (SEM_ID semId);
extern STATUS	semMInit (SEMAPHORE *pSem, int options);
extern STATUS	semMCoreInit (SEMAPHORE *pSemaphore, int options);
extern STATUS	semMGive (SEM_ID semId);
extern STATUS	semMTake (SEM_ID semId, int timeout);
extern STATUS	semMGiveKern (SEM_ID semId);
extern STATUS	semMPendQPut (SEM_ID semId, int timeout);
extern STATUS	semCInit (SEMAPHORE *pSem,int options,int initialCount);
extern STATUS	semCCoreInit (SEMAPHORE *pSemaphore, int options,
			      int initialCount);
extern STATUS	semCGive (SEM_ID semId);
extern STATUS	semCTake (SEM_ID semId, int timeout);
extern void	semCGiveDefer (SEM_ID semId);
extern STATUS	semOTake (SEM_ID semId);


# 185 "d:/Tornado2.2/target/h/private/semLibP.h"


# 201 "d:/Tornado2.2/target/h/private/semLibP.h"












# 21 "d:/Tornado2.2/target/h/private/selectLibP.h" 2

typedef struct selWkNode
    {
    NODE		linkedListHooks; 
    BOOL		dontFree;	 
    int			taskId;		 
    int			fd;		 
    SELECT_TYPE		type;		 
    } SEL_WAKEUP_NODE;

typedef struct
    {
    SEMAPHORE		listMutex;	 
    SEL_WAKEUP_NODE	firstNode;	 
    LIST		wakeupList;	 
    } SEL_WAKEUP_LIST;

typedef struct selContext
    {
    SEMAPHORE	wakeupSem;		 
    BOOL     	pendedOnSelect;		 

    fd_set     *pReadFds;		 
    fd_set     *pWriteFds;		 

     

    fd_set     *pOrigReadFds;		 
    fd_set     *pOrigWriteFds;		 
    int		width;			 

     
# 63 "d:/Tornado2.2/target/h/private/selectLibP.h"

    } SEL_CONTEXT;


 



extern void	selectInit		(int numFiles);
extern void	selTaskDeleteHookAdd 	(void);
















# 56 "d:/Tornado2.2/target/h/selectLib.h" 2

 



extern SELECT_TYPE  selWakeupType 	(SEL_WAKEUP_NODE *pWakeupNode);
extern STATUS 	    selNodeAdd 	      	(SEL_WAKEUP_LIST *pWakeupList,
			    		 SEL_WAKEUP_NODE *pWakeupNode);
extern STATUS 	    selNodeDelete 	(SEL_WAKEUP_LIST *pWakeupList,
			       		 SEL_WAKEUP_NODE *pWakeupNode);
extern int 	    selWakeupListLen 	(SEL_WAKEUP_LIST *pWakeupList);
extern void 	    selWakeup 		(SEL_WAKEUP_NODE *pWakeupNode);
extern void 	    selWakeupAll 	(SEL_WAKEUP_LIST *pWakeupList, 
					 SELECT_TYPE type);
extern void 	    selWakeupListInit 	(SEL_WAKEUP_LIST *pWakeupList);
extern void 	    selWakeupListTerm 	(SEL_WAKEUP_LIST *pWakeupList);
extern int	    select 		(int width, fd_set *pReadFds, 
					 fd_set *pWriteFds, fd_set *pExceptFds,
					 struct timeval *pTimeOut);


# 89 "d:/Tornado2.2/target/h/selectLib.h"







# 64 "d:/Tornado2.2/target/h/tyLib.h" 2
# 1 "d:/Tornado2.2/target/h/vwModNum.h" 1
 

 

 
# 94 "d:/Tornado2.2/target/h/vwModNum.h"


# 253 "d:/Tornado2.2/target/h/vwModNum.h"

# 65 "d:/Tornado2.2/target/h/tyLib.h" 2


 

typedef struct		 
    {
    DEV_HDR	devHdr;		 

    RING_ID	rdBuf;		 
    SEMAPHORE	rdSyncSem;	 
    SEMAPHORE	mutexSem;	 
    struct			 
	{
	unsigned char xoff;      
	unsigned char pending;   
        unsigned char canceled;  
	unsigned char flushingRdBuf;  
	}	rdState;

    RING_ID	wrtBuf;		 
    SEMAPHORE	wrtSyncSem;	 
    struct			 
	{
	unsigned char busy;      
	unsigned char xoff;      
	unsigned char cr;        
        unsigned char canceled;  
	unsigned char flushingWrtBuf;  
	unsigned char wrtBufBusy;  
	}	wrtState;

    UINT8	lnNBytes;	 
    UINT8	lnBytesLeft;	 

    unsigned short options;	 
    FUNCPTR	txStartup;	 
    FUNCPTR	protoHook;	 
    int		protoArg;	 
    SEL_WAKEUP_LIST selWakeupList; 
    int		numOpen;	 
    } TY_DEV;

 

typedef TY_DEV * TY_DEV_ID;

 



extern STATUS 	tyDevInit (TY_DEV_ID pTyDev, int rdBufSize, int wrtBufSize,
			   FUNCPTR txStartup);
extern STATUS 	tyITx (TY_DEV_ID pTyDev, char *pChar);
extern STATUS 	tyIRd (TY_DEV_ID pTyDev, char inchar);
extern STATUS 	tyIoctl (TY_DEV_ID pTyDev, int request, int arg);
extern int 	tyRead (TY_DEV_ID pTyDev, char *buffer, int maxbytes);
extern int 	tyWrite (TY_DEV_ID pTyDev, char *buffer, int nbytes);
extern void 	tyAbortFuncSet (FUNCPTR func);
extern void 	tyAbortSet (char ch);
extern void 	tyBackspaceSet (char ch);
extern void 	tyDeleteLineSet (char ch);
extern void 	tyEOFSet (char ch);
extern void 	tyMonitorTrapSet (char ch);


# 145 "d:/Tornado2.2/target/h/tyLib.h"







# 25 "d:/Tornado2.2/target/h/drv/serial/pcConsole.h" 2



 

typedef struct 
    {
    BOOL	curMode;		 
    int		kbdMode;		 
    UINT16	kbdFlags;		 
    UINT16	kbdState;		 
    int		currCon;		 		
    FUNCPTR 	kbdHook;		 
    BOOL	convertChar;		 
    } KBD_CON_DEV;
   
 

typedef struct 
    {
    UCHAR *	memBase;		 
    UCHAR *	selReg;			 
    UCHAR *	valReg;			 
    int 	row, col;		 
    UCHAR *	curChrPos;      	 
    UCHAR	curAttrib;		 
    UCHAR	defAttrib;      	 
    int 	nrow, ncol;		 
    int 	scst, sced;		 
    BOOL	rev;			 
    BOOL	autoWrap;		 
    BOOL	sv_rev;			 
    int 	sv_row, sv_col;		 
    UCHAR	sv_curAttrib;	 	 
    BOOL	scrollCheck;     	 
    UCHAR *	charSet;         	 
    int		vgaMode;         	 
    BOOL	colorMode;       	 
    BOOL	insMode;         	 
    char	tab_stop [80];      	 
    UINT16	escFlags;		 
    int 	escParaCount;	 	 
    int 	escPara[16];  	 
    BOOL	escQuestion;     	 
    char	escResp[10];     	 
    FUNCPTR     vgaHook;		 
    } VGA_CON_DEV;


 

typedef struct				 
    {
    TY_DEV	tyDev;
    BOOL	created;		 
    KBD_CON_DEV * ks;			 
    VGA_CON_DEV * vs;			 
    } PC_CON_DEV;

 







 











 














 




 














 











 










































 


extern	void	kbdIntr (void);
extern  void 	kbdHrdInit (void);
extern	int	pcConDrv (void);
extern	int	pcConDevCreate (char *name, register int channel, int rdBufSize,
			      int wrtBufSize);
extern  void	vgaHrdInit (void);
extern	int 	vgaWriteString (register PC_CON_DEV * pPcCoDv);


# 214 "d:/Tornado2.2/target/h/drv/serial/pcConsole.h"









# 79 "pc.h" 2
# 1 "d:/Tornado2.2/target/h/drv/parallel/lptDrv.h" 1
 

 

 
# 17 "d:/Tornado2.2/target/h/drv/parallel/lptDrv.h"










 

# 1 "d:/Tornado2.2/target/h/iosLib.h" 1
 

 

 
# 36 "d:/Tornado2.2/target/h/iosLib.h"


# 131 "d:/Tornado2.2/target/h/iosLib.h"

# 30 "d:/Tornado2.2/target/h/drv/parallel/lptDrv.h" 2


typedef struct lptDev		 
    {
    DEV_HDR	devHdr;
    BOOL	created;	 
    BOOL	autofeed;	 
    BOOL	inservice;	 
    ULONG	data;		 
    ULONG	stat;		 
    ULONG	ctrl;		 
    int 	intCnt;		 
    int 	retryCnt;	 
    int		busyWait;	 
    int 	strobeWait;	 
    int 	timeout;	 
    int 	intLevel;	 
    SEM_ID	muteSem;	 
    SEM_ID	syncSem;	 
    } LPT_DEV;

typedef struct lptResource	 
    {
    int		ioBase;		 
    int		intVector;	 
    int		intLevel;	 
    BOOL	autofeed;        
    int		busyWait;        
    int		strobeWait;      
    int		retryCnt;        
    int		timeout;         
    int		regDelta;	 
    } LPT_RESOURCE;

 



 





 





 





 








 








 




extern LPT_RESOURCE lptResources[];

 



STATUS	lptDrv (int channels, LPT_RESOURCE *pResource);
STATUS	lptDevCreate (char *name, int channel);


















# 80 "pc.h" 2
# 1 "d:/Tornado2.2/target/h/drv/pcmcia/pcmciaLib.h" 1
 

 
 

 














# 1 "d:/Tornado2.2/target/h/vwModNum.h" 1
 

 

 
# 94 "d:/Tornado2.2/target/h/vwModNum.h"


# 253 "d:/Tornado2.2/target/h/vwModNum.h"

# 22 "d:/Tornado2.2/target/h/drv/pcmcia/pcmciaLib.h" 2


 







# 1 "d:/Tornado2.2/target/h/dllLib.h" 1
 

 

 
# 20 "d:/Tornado2.2/target/h/dllLib.h"


# 172 "d:/Tornado2.2/target/h/dllLib.h"

# 33 "d:/Tornado2.2/target/h/drv/pcmcia/pcmciaLib.h" 2

# 1 "d:/Tornado2.2/target/h/sysLib.h" 1
 

 

 
# 69 "d:/Tornado2.2/target/h/sysLib.h"









# 1 "d:/Tornado2.2/target/h/bootLib.h" 1
 

 

 
# 27 "d:/Tornado2.2/target/h/bootLib.h"








 
















typedef struct				 
    {
    char bootDev [40];	 
    char hostName [20];	 
    char targetName [20];	 
    char ead [50];	 
    char bad [50];	 
    char had [30];		 
    char gad [30];		 
    char bootFile [160];	 
    char startupScript [160];	 
    char usr [20];		 
    char passwd [20];	 
    char other [80];	 
    int  procNum;			 
    int  flags;				 
    int  unitNum;                        
    } BOOT_PARAMS;

 



extern STATUS 	bootBpAnchorExtract (char *string, char ** pAnchorAdrs);
extern STATUS 	bootLeaseExtract (char *string, u_long *pLeaseLen, 
                                  u_long *pLeaseStart);
extern STATUS 	bootNetmaskExtract (char *string, int *pNetmask);
extern STATUS 	bootScanNum (char ** ppString, int *pValue, BOOL hex);
extern STATUS 	bootStructToString (char *paramString, BOOT_PARAMS
		*pBootParams);
extern char *	bootStringToStruct (char *bootString, BOOT_PARAMS *pBootParams);
extern void 	bootParamsErrorPrint (char *bootString, char *pError);
extern void 	bootParamsPrompt (char *string);
extern void 	bootParamsShow (char *paramString);


# 100 "d:/Tornado2.2/target/h/bootLib.h"







# 79 "d:/Tornado2.2/target/h/sysLib.h" 2
# 1 "d:/Tornado2.2/target/h/ttyLib.h" 1
 

 

 










# 1 "d:/Tornado2.2/target/h/types/vxTypes.h" 1
 

 

 
# 17 "d:/Tornado2.2/target/h/types/vxTypes.h"

 
# 56 "d:/Tornado2.2/target/h/types/vxTypes.h"


# 150 "d:/Tornado2.2/target/h/types/vxTypes.h"

# 17 "d:/Tornado2.2/target/h/ttyLib.h" 2
# 1 "d:/Tornado2.2/target/h/sioLib.h" 1
 

 

 
# 22 "d:/Tornado2.2/target/h/sioLib.h"




# 1 "d:/Tornado2.2/target/h/types/vxTypes.h" 1
 

 

 
# 17 "d:/Tornado2.2/target/h/types/vxTypes.h"

 
# 56 "d:/Tornado2.2/target/h/types/vxTypes.h"


# 150 "d:/Tornado2.2/target/h/types/vxTypes.h"

# 27 "d:/Tornado2.2/target/h/sioLib.h" 2






 











 




 
# 60 "d:/Tornado2.2/target/h/sioLib.h"







 





 




 





 

 

 











 




 
 

 















 
# 133 "d:/Tornado2.2/target/h/sioLib.h"








 
# 159 "d:/Tornado2.2/target/h/sioLib.h"





 
# 179 "d:/Tornado2.2/target/h/sioLib.h"





 

typedef struct sio_drv_funcs SIO_DRV_FUNCS;

typedef struct sio_chan				 
    {
    SIO_DRV_FUNCS * pDrvFuncs;
     
    } SIO_CHAN;

struct sio_drv_funcs				 
    {
    int		(*ioctl)
			(
			SIO_CHAN *	pSioChan,
			int		cmd,
			void *		arg
			);

    int		(*txStartup)
			(
			SIO_CHAN *	pSioChan
			);

    int		(*callbackInstall)
			(
			SIO_CHAN *	pSioChan,
			int		callbackType,
			STATUS		(*callback)(void *, ...),
			void *		callbackArg
			);

    int		(*pollInput)
			(
			SIO_CHAN *	pSioChan,
			char *		inChar
			);

    int		(*pollOutput)
			(
			SIO_CHAN *	pSioChan,
			char 		outChar
			);
    };


 



















# 18 "d:/Tornado2.2/target/h/ttyLib.h" 2







extern STATUS ttyDrv	   ();
extern STATUS ttyDevCreate (char *name, SIO_CHAN *pChan, int rdBufSize,
			    int wrtBufSize);














# 80 "d:/Tornado2.2/target/h/sysLib.h" 2



typedef struct   
    {
    char *ifName;  		     	 
    FUNCPTR attachRtn;  		 
    char *arg1;				 
    int arg2;				 
    int arg3;				 
    int arg4;
    int arg5;
    int arg6;
    int arg7;
    int arg8;
    } NETIF;



 






 







 

 







 










                                         










 



extern int 	sysBus;		 
extern int 	sysCpu;		 
extern int 	sysProcNum;	 
extern char *	sysBootLine;	 
extern char *	sysExcMsg;	 
extern int	sysFlags;	 
extern BOOT_PARAMS sysBootParams;  

 

extern char	sysBootHost[];	 
extern char	sysBootFile[];	 

 



extern char *	sysModel (void);
extern char *	sysBspRev (void);
extern void 	sysHwInit (void);
extern void 	sysHwInit2 (void);
extern char *	sysMemTop (void);
extern char *	sysPhysMemTop (void);
extern STATUS 	sysToMonitor (int startType);
extern int 	sysProcNumGet (void);
extern void 	sysProcNumSet (int procNum);
extern BOOL 	sysBusTas (char *adrs);
extern STATUS 	sysNvRamGet (char *string, int strLen, int offset);
extern STATUS 	sysNvRamSet (char *string, int strLen, int offset);
extern STATUS 	sysScsiInit (void);
extern STATUS 	sysScsiConfig (void);
extern void	sysSerialHwInit (void);
extern void	sysSerialHwInit2 (void);
extern SIO_CHAN * sysSerialChanGet (int channel);
extern void	sysSerialReset (void);
extern STATUS	sysLocalToBusAdrs (int adrsSpace, char *localAdrs,
				   char **pBusAdrs);
extern STATUS	sysBusToLocalAdrs (int adrsSpace, char *busAdrs,
				   char **pLocalAdrs);
extern STATUS	sysIntDisable (int intLevel);
extern STATUS	sysIntEnable (int intLevel);
extern int	sysBusIntAck (int intLevel);
extern STATUS	sysBusIntGen (int level, int vector);
extern STATUS	sysMailboxConnect (FUNCPTR routine, int arg);
extern STATUS	sysMailboxEnable (char *mailboxAdrs);
extern int	tyCoDrv (void);
extern int	tyCoDevCreate (char *name, int channel, int rdBufSize,
			       int wrtBufSize);



 





extern UCHAR	sysInByte		(int port);
extern USHORT	sysInWord		(int port);
extern ULONG	sysInLong		(int port);
extern void	sysInWordString		(int port, short *pData, int count);
extern void	sysInLongString		(int port, long *pData, int count);
extern void	sysOutByte		(int port, char data);
extern void	sysOutWord		(int port, short data);
extern void	sysOutLong		(int port, long data);
extern void	sysOutWordString	(int port, short *pData, int count);
extern void	sysOutLongString	(int port, long *pData, int count);


# 234 "d:/Tornado2.2/target/h/sysLib.h"

 

extern void	sysNanoDelay		(UINT32 nanoseconds);
extern void	sysReboot		(void);
extern void	sysDelay		(void);
extern void	sysWait			(void);
extern STATUS	sysIntDisablePIC	(int intLevel);
extern STATUS	sysIntEnablePIC		(int intLevel);

 

extern void 	sysFaultTableInit	(void (*func)());
extern UINT32 	sysFaultVecSet		(INSTR *vector, UINT32 faultNo, 
					 UINT32 type);
extern void 	sysExcInfoPrint		(UINT32 type);

 

extern void	sysLoadGdt		(char *sysGdtr);



# 307 "d:/Tornado2.2/target/h/sysLib.h"









# 35 "d:/Tornado2.2/target/h/drv/pcmcia/pcmciaLib.h" 2
# 1 "d:/Tornado2.2/target/h/dosFsLib.h" 1
 

 

 
# 30 "d:/Tornado2.2/target/h/dosFsLib.h"









# 1 "d:/Tornado2.2/target/h/cbioLib.h" 1
 

 

 
# 19 "d:/Tornado2.2/target/h/cbioLib.h"








 


 



typedef	unsigned long block_t ;		 
typedef	unsigned long cookie_t ;	 
typedef struct cbioDev * CBIO_DEV_ID ;   

typedef enum                             
        {CBIO_READ, CBIO_WRITE}          
        CBIO_RW;


typedef struct cbioParams	 
    {
    BOOL	cbioRemovable;	 
    block_t 	nBlocks;	 
    size_t 	bytesPerBlk;	 
    size_t	blockOffset;	 
    short	blocksPerTrack;	 
    short	nHeads;		 
    short	retryCnt;	 
    block_t 	lastErrBlk;	 
    int 	lastErrno;	 
    } CBIO_PARAMS;


 



 
extern STATUS cbioLibInit
    (
    void
    );

 
extern	STATUS cbioBlkRW		
    (
    CBIO_DEV_ID		dev,
    block_t		startBlock,
    block_t		numBlocks,
    addr_t		buffer,
    CBIO_RW		rw,
    cookie_t *		pCookie
    );


 
extern STATUS cbioBytesRW		
    (
    CBIO_DEV_ID 	dev,
    block_t		startBlock,
    off_t		offset,
    addr_t		buffer,
    size_t		nBytes,
    CBIO_RW		rw,
    cookie_t *		pCookie
    );


 
extern STATUS cbioBlkCopy		
    (
    CBIO_DEV_ID 	dev,
    block_t		srcBlock,
    block_t		dstBlock,
    block_t		numBlocks
    );


 
extern STATUS cbioIoctl			
    (
    CBIO_DEV_ID		dev,
    int			command,
    addr_t		arg
    );


 
extern int cbioModeGet  
    (
    CBIO_DEV_ID dev
    );


 
extern STATUS cbioModeSet  
    (
    CBIO_DEV_ID dev,
    int mode
    );


 
extern int cbioRdyChgdGet 
    (
    CBIO_DEV_ID dev
    );


 
extern STATUS cbioRdyChgdSet  
    (
    CBIO_DEV_ID dev,
    BOOL status
    );


 
extern STATUS cbioLock  
    (
    CBIO_DEV_ID	dev,
    int		timeout	 
    );


 
extern STATUS cbioUnlock 
    (
    CBIO_DEV_ID	dev
    );


 
extern STATUS cbioParamsGet		
    (
    CBIO_DEV_ID dev,
    CBIO_PARAMS * pCbioParams		
    );


 
extern STATUS cbioShow	
    (
    CBIO_DEV_ID dev
    );

              
extern STATUS cbioDevVerify                     
    (                                           
    CBIO_DEV_ID device                          
    );                                          
                                                
        
extern CBIO_DEV_ID cbioWrapBlkDev               
    (                                           
    BLK_DEV * pDevice                            
    );                                          

 












 











# 40 "d:/Tornado2.2/target/h/dosFsLib.h" 2


 


 











 




 




 








 

 
 

typedef struct           
    {                            
    enum
        { _AUTO=0, _FAT12=12, _FAT16=16, _FAT32=32 }
                fatType;         
    const char * sysId ;         
    int         secPerClust;     
    short       nResrvd;         
    short       maxRootEnts;     
    char        nFats;           
    ULONG       secPerFat;       
    ULONG       nClust;          
    ULONG       nHidden;         
    ULONG       volSerial ;      
    int         secPerTrack;     
    char        nHeads;          
    char        mediaByte;       
    char        volLabel[ 11 ];  
    } DOS_VOL_CONFIG;

  




typedef struct DOS_VOLUME_DESC *        DOS_VOLUME_DESC_ID;

 








 
 



































 

 

 

extern STATUS dosFsLibInit( int ignored );
extern STATUS dosFsDevCreate ( char * pDevName, CBIO_DEV_ID cbio,
			       u_int maxFiles, u_int autoChkLevel );
extern STATUS dosFsVolUnmount ( void * pDev );
extern STATUS dosFsShow( void * dev, u_int level );
extern STATUS dosFsVolFormat( void * pDev, int opt, FUNCPTR pPromptFunc );
extern void dosFsFmtLibInit( void );
extern void dosChkLibInit( void );
extern STATUS dosDirOldLibInit( void );
extern STATUS dosVDirLibInit ( void );
extern STATUS dosFsFatInit ( void );
extern DOS_VOLUME_DESC_ID dosFsVolDescGet (void * pDevNameOrPVolDesc, 
                                           u_char **   ppTail);

extern STATUS dosFsLastAccessDateEnable (DOS_VOLUME_DESC_ID dosVolDescId, 
                                  BOOL enable);

extern STATUS dosSetVolCaseSens  
    (
    DOS_VOLUME_DESC_ID pVolDesc,
    BOOL sensitivity  
    );

 








 


# 206 "d:/Tornado2.2/target/h/dosFsLib.h"


# 220 "d:/Tornado2.2/target/h/dosFsLib.h"






 


typedef	void * DOS_VOL_DESC ;

 

typedef struct		 
    {
    UINT8		dospt_status;		 
    UINT8		dospt_startHead;	 
    short		dospt_startSec;		 
    UINT8		dospt_type;		 
    UINT8		dospt_endHead;		 
    short		dospt_endSec;		 
    ULONG		dospt_absSec;		 
    ULONG		dospt_nSectors;		 
    } __attribute__((packed, aligned(2))) DOS_PART_TBL;


 
 
typedef struct           
    {
    int         dosdt_year;              
    int         dosdt_month;             
    int         dosdt_day;               
    int         dosdt_hour;              
    int         dosdt_minute;            
    int         dosdt_second;            
    } DOS_DATE_TIME;

 




 


 





 
extern DOS_VOL_DESC *	dosFsDevInit (char *pDevName, BLK_DEV *pBlkDev,
		                      DOS_VOL_CONFIG *pConfig);
extern STATUS 		dosFsInit (int maxFiles);
extern DOS_VOL_DESC *	dosFsMkfs (char *pVolName, BLK_DEV *pBlkDev);

 








# 36 "d:/Tornado2.2/target/h/drv/pcmcia/pcmciaLib.h" 2
# 1 "d:/Tornado2.2/target/h/drv/pcmcia/pccardLib.h" 1
  

 

 





























typedef struct pccardEnabler
    {
    int		type;		 
    void	*pResource;	 
    int		resourceNumEnt;	 
    FUNCPTR	enableRtn;	 
    FUNCPTR	showRtn;	 
    } PCCARD_ENABLER;

typedef struct pccardResource
    {
    int		vcc;		 
    int		vpp;		 
    int		ioStart[2];	 
    int		ioStop[2];	 
    int		ioExtraws;	 
    int		memStart;	 
    int		memStop;	 
    int		memExtraws;	 
    int		memOffset;	 
    int		memLength;	 
    } PCCARD_RESOURCE;

typedef struct ataResource	 
    {
    PCCARD_RESOURCE resource;	 
    int		ctrlType;	 
    int		drives;		 
    int		intVector;	 
    int		intLevel;	 
    int		configType;	 
    int		semTimeout;	 
    int		wdgTimeout;	 
    int		sockTwin;	 
    int		pwrdown;	 
    } ATA_RESOURCE;

typedef struct sramResource	 
    {
    PCCARD_RESOURCE resource;	 
    } SRAM_RESOURCE;

typedef struct eltResource	 
    {
    PCCARD_RESOURCE resource;	 
    int		intVector;	 
    int		intLevel;	 
    int		rxFrames;	 
    int		connector;	 
    } ELT_RESOURCE;

typedef struct tffsResource	 
    {
    PCCARD_RESOURCE resource;	 
    } TFFS_RESOURCE;


 



extern STATUS	pccardMount		(int sock, char *pName);
extern STATUS	pccardMkfs		(int sock, char *pName);
extern STATUS	pccardEltEnabler	(int sock, ELT_RESOURCE *pEltResource,
			 		 int numEnt, FUNCPTR showRtn);
extern STATUS	pccardAtaEnabler	(int sock, ATA_RESOURCE *pAtaResource,
			 		 int numEnt, FUNCPTR showRtn);
extern STATUS	pccardSramEnabler	(int sock, SRAM_RESOURCE *pSramResource,
			 		 int numEnt, FUNCPTR showRtn);
extern STATUS	pccardTffsEnabler	(int sock, TFFS_RESOURCE *pTffsResource,
			 		 int numEnt, FUNCPTR showRtn);
extern void	pccardShowInit		(void);


# 119 "d:/Tornado2.2/target/h/drv/pcmcia/pccardLib.h"










# 37 "d:/Tornado2.2/target/h/drv/pcmcia/pcmciaLib.h" 2












typedef struct pcmciaCard		 
    {
    int		type;			 
    int		sock;			 
    int		ctrl;			 
    BOOL	detected;		 
    BOOL	installed;		 
    BOOL	changed;		 
    int		regBase;		 
    int		regMask;		 
    int		cardStatus;		 
    int		initStatus;		 
    FUNCPTR	cscIntr;		 
    FUNCPTR	showRtn;		 
    DL_LIST	cisTupleList;		 
    DL_LIST	cisConfigList;		 
    PCCARD_RESOURCE *pResource;		 
    BLK_DEV	*pBlkDev;		 
    NETIF	*pNetIf;		 
    DOS_VOL_DESC *pDos;			 
    } PCMCIA_CARD;

typedef struct pcmciaChip		 
    {
    int		type;			 
    char	*name;			 
    BOOL	installed;		 
    int		socks;			 
    int		flags;			 
    int		intLevel;		 
    int		memWindows;		 
    int		ioWindows;		 
    FUNCPTR	reset;			 
    FUNCPTR	status;			 
    FUNCPTR	flagGet;		 
    FUNCPTR	flagSet;		 
    FUNCPTR	cscOn;			 
    FUNCPTR	cscOff;			 
    FUNCPTR	cscPoll;		 
    FUNCPTR	irqGet;			 
    FUNCPTR	irqSet;			 
    FUNCPTR	iowinGet;		 
    FUNCPTR	iowinSet;		 
    FUNCPTR	memwinGet;		 
    FUNCPTR	memwinSet;		 
    FUNCPTR	showRtn;		 
    } PCMCIA_CHIP;

typedef struct pcmciaCtrl
    {
    int		socks;			 
    int		memBase;		 
    PCMCIA_CHIP chip;			 
    PCMCIA_CARD card[8];	 
    } PCMCIA_CTRL;

typedef struct pcmciaIowin
    {
    int		window;
    int		flags;
    int		extraws;
    int		start;
    int		stop;
    } PCMCIA_IOWIN;

typedef struct pcmciaMemwin
    {
    int		window;
    int		flags;
    int		extraws;
    int		start;
    int		stop;
    int		cardstart;
    } PCMCIA_MEMWIN;

typedef struct pcmciaAdapter
    {
    int		type;			 
    int		ioBase;			 
    int		intVec;			 
    int		intLevel;		 
    FUNCPTR	initRtn;		 
    FUNCPTR	showRtn;		 
    } PCMCIA_ADAPTER;

typedef struct pcmciaMsg
    {
    VOIDFUNCPTR	func;			 
    int		arg [6];	 
    } PCMCIA_MSG;

 




 





 






 




 








 











 













 












 









 



extern STATUS 	pcmciaInit	(void);
extern STATUS 	pcmciaJobAdd	(VOIDFUNCPTR func, int arg1, int arg2, 
				 int arg3, int arg4, int arg5, int arg6);
extern void 	pcmciad		(void);
extern void 	pcmciaShowInit	(void);
extern void 	pcmciaShow	(int sock);


# 241 "d:/Tornado2.2/target/h/drv/pcmcia/pcmciaLib.h"









# 81 "pc.h" 2
# 1 "d:/Tornado2.2/target/h/drv/hdisk/ataDrv.h" 1
 

 
 
# 18 "d:/Tornado2.2/target/h/drv/hdisk/ataDrv.h"













# 1 "d:/Tornado2.2/target/h/wdLib.h" 1
 

 

 
# 21 "d:/Tornado2.2/target/h/wdLib.h"









# 1 "d:/Tornado2.2/target/h/vwModNum.h" 1
 

 

 
# 94 "d:/Tornado2.2/target/h/vwModNum.h"


# 253 "d:/Tornado2.2/target/h/vwModNum.h"

# 31 "d:/Tornado2.2/target/h/wdLib.h" 2

 

typedef struct wdog *WDOG_ID;		 

 



extern STATUS 	wdLibInit (void);
extern WDOG_ID 	wdCreate (void);
extern STATUS 	wdDelete (WDOG_ID wdId);
extern STATUS 	wdStart (WDOG_ID wdId, int delay, FUNCPTR pRoutine,
			 int parameter);
extern STATUS 	wdCancel (WDOG_ID wdId);
extern void 	wdShowInit (void);
extern STATUS 	wdShow (WDOG_ID wdId);


# 60 "d:/Tornado2.2/target/h/wdLib.h"







# 32 "d:/Tornado2.2/target/h/drv/hdisk/ataDrv.h" 2



extern ATA_RESOURCE ataResources[];
 













typedef struct ataParams 
    {
    short config;		 
    short cylinders;		 
    short removcyl;		 
    short heads;		 
    short bytesTrack;		 
    short bytesSec;		 
    short sectors;		 
    short bytesGap;		 
    short bytesSync;		 
    short vendstat;		 
    char  serial[20];		 
    short type;			 
    short size;			 
    short bytesEcc;		 
    char  rev[8];		 
    char  model[40];		 
    short multiSecs;		 
    short reserved48;		 
    short capabilities;		 
    short reserved50;		 
    short pioMode;		 
    short dmaMode;		 
    short valid;		 
    short currentCylinders;	 
    short currentHeads;		 
    short currentSectors;	 
    short capacity0;		 
    short capacity1;		 
    short multiSet;		 
    short sectors0;		 
    short sectors1;		 
    short singleDma;		 
    short multiDma;		 
    short advancedPio;		 
    short cycletimeDma;		 
    short cycletimeMulti;	 
    short cycletimePioNoIordy;	 
    short cycletimePioIordy;	 
    short reserved69;		 
    short reserved70;		 

     

    short pktCmdRelTime;	 
    short servCmdRelTime;	 
    short majorRevNum;		 
    short minorVersNum;		 
    short reserved75[53];	 
    short vendor[32];		 
    short reserved160[96];	 
    } ATA_PARAM;

typedef enum  
    {
    NON_DATA,  
    OUT_DATA,
    IN_DATA
    } t_data_dir;

 









 















typedef struct ataDev
    {
    BLK_DEV     blkDev;		 
    int         ctrl;		 
    int         drive;		 
    int         blkOffset;	 
    int		nBlocks;	 

    char *	pBuf;		 
    char *	pBufEnd;	 
    t_data_dir	direction;	 
    int		transCount;	 
    int		errNum;		 

     

    uint8_t	intReason;	 
    uint8_t	status;		 
    uint16_t	transSize;	 
    } ATA_DEV;

typedef struct ataDrive
    {
    ATA_PARAM	param;		 
    short	okMulti;	 
    short	okIordy;	 
    short	okDma;		 
    short	okLba;		 
    short	multiSecs;	 
    short	pioMode;	 
    short	singleDmaMode;	 
    short	multiDmaMode;	 
    short	rwMode;		 
    short	rwBits;		 
    short	rwPio;		 
    short	rwDma;		 

    uint8_t	state;		 
    uint8_t	diagCode;	 
    uint8_t	type;		 
    STATUS      (*Reset)	 
        (
        int ctrl,
        int dev
        );

    ATA_DEV     *pAtaDev;	 
    } ATA_DRIVE;

typedef struct ataCtrl
    {
    ATA_DRIVE	drive[2];	 
    SEMAPHORE	syncSem;	 
    SEMAPHORE	muteSem;	 
    WDOG_ID	wdgId;		 
    BOOL	wdgOkay;	 
    int		semTimeout;	 
    int		wdgTimeout;	 
    int		ctrlType;	 
    BOOL	installed;	 
    BOOL	changed;	 
    int		intLevel;	 
    int		intCount;	 
    int		intStatus;	 
    int		drives;		 
    UINT32	data;		 
    UINT32	error;		 
    UINT32	feature;	 
    UINT32	seccnt;		 
    UINT32	sector;		 
    UINT32	cylLo;		 
    UINT32	cylHi;		 
    UINT32	sdh;		 
    UINT32	command;	 
    UINT32	status;		 
    UINT32	aStatus;	 
    UINT32	dControl;	 
    UINT32	dAddress;	 

    int		configType;	 
    } ATA_CTRL;

typedef struct ataType
    {
    int cylinders;		 
    int heads;			 
    int sectors;		 
    int bytes;			 
    int precomp;		 
    } ATA_TYPE;

typedef struct ataRaw
    {				 
    UINT cylinder;		 
    UINT head;			 
    UINT sector;		 
    char *pBuf;			 
    UINT nSecs;			 
    UINT direction;		 
    } ATA_RAW;






 
















 



 





 


					 










 




 














 






 







 



















 
















 

































 

 

















 







 



 
 



 
 



 



 












 

















 




 





 




 















 





 

 



extern STATUS	ataDrv		(int ctrl, int drives, int vector, int level,
				 int configType, int semTimeout,
				 int wdgTimeout);
extern BLK_DEV	*ataDevCreate	(int ctrl, int drive, int nBlks, int offset);
extern STATUS	ataRawio	(int ctrl, int drive, ATA_RAW *pAtaRaw);
extern void	ataShowInit	(void);
extern STATUS	ataShow		(int ctrl, int drive);
extern int	usrAtaPartition	(int ctrl, int drive, DOS_PART_TBL *pPart);
extern STATUS   usrAtaConfig	(int ctrl, int drive, char *fileName);
extern void     usrAtaInit	(void);


# 534 "d:/Tornado2.2/target/h/drv/hdisk/ataDrv.h"










# 82 "pc.h" 2
# 1 "d:/Tornado2.2/target/h/arch/i86/mmuI86Lib.h" 1
 

 

 
# 15 "d:/Tornado2.2/target/h/arch/i86/mmuI86Lib.h"

























typedef struct
    {
    unsigned present:1;
    unsigned rw:1;
    unsigned us:1;
    unsigned pwt:1;
    unsigned pcd:1;
    unsigned access:1;
    unsigned dirty:1;
    unsigned zero:2;
    unsigned avail:3;
    unsigned page:20;
    } PTE_FIELD;

typedef union pte
    {
    PTE_FIELD field;
    unsigned int bits;
    } PTE;

typedef struct mmuTransTblStruct
    {
    PTE *pDirectoryTable;
    } MMU_TRANS_TBL;
















 



extern STATUS	mmuI86LibInit (int pageSize);
extern STATUS	mmuI86Enable (BOOL enable);
extern void	mmuI86On ();
extern void	mmuI86Off ();
extern void	mmuI86TLBFlush ();
extern void	mmuI86PdbrSet (MMU_TRANS_TBL * transTbl);
extern MMU_TRANS_TBL *	mmuI86PdbrGet ();

extern void	vmBaseArch32LibInit (void);
extern void	vmBaseArch36LibInit (void);
extern STATUS	vmBaseArch32Map (void * virtAddr, void * physAddr,
		    UINT32 stateMask, UINT32 state, UINT32 len);
extern STATUS	vmBaseArch32Translate (void * virtAddr, void ** physAddr);
extern void	vmArch32LibInit (void);
extern void	vmArch36LibInit (void);
extern STATUS	vmArch32Map ();
extern STATUS	vmArch32Translate ();


# 122 "d:/Tornado2.2/target/h/arch/i86/mmuI86Lib.h"









# 83 "pc.h" 2
# 1 "d:/Tornado2.2/target/h/arch/i86/ipiI86Lib.h" 1
 

 

 















 







 

extern char	ipiCallTbl [];		 


 



extern void	ipiVecInit (UINT32 intNum);
extern void	ipiHandler (UINT32 index);
extern STATUS	ipiConnect (UINT32 intNum, VOIDFUNCPTR routine);
extern STATUS	ipiStartup (UINT32 apicId, UINT32 vector, UINT32 nTimes);
extern STATUS	ipiShutdown (UINT32 apicId, UINT32 vector);
extern void	ipiStub (void);
extern void	ipiShutdownSup (void);
extern void	ipiHandlerTlbFlush (void);
extern void	ipiHandlerTscReset (void);
extern void	ipiHandlerShutdown (void);


# 63 "d:/Tornado2.2/target/h/arch/i86/ipiI86Lib.h"










# 84 "pc.h" 2
# 1 "d:/Tornado2.2/target/h/drv/intrCtl/loApic.h" 1
 

  

 















 


























 





 



 








 
















 




 












 








 









 







 



 










 

typedef struct			 
    {
    char    signature [4];	 
    UINT32  configTableAddr;	 
    UINT8   length;		 
    UINT8   specRev;		 
    UINT8   cksum;		 
    UINT8   featureByte[5];	 
    } MP_FPS;

typedef struct			 
    {
    char    mpSignature[4];	 
    UINT16  tableLength;	 
    UINT8   specRevision;	 
    UINT8   cksum;		 
    char    oemId[8];		 
    char    prodId[12];		 
    UINT32  oemTablePtr;	 
    UINT16  oemTableSize;	 
    UINT16  entryCount;		 
    UINT32  localApicBaseAddr;	 
    UINT16  extendedTableLength;  
    UINT8   extendedTableCksum;  
    UINT8   reserved;            
    } MP_HEADER; 

typedef struct			 
    {
    UINT8   entryType;		 
    UINT8   localApicId;	 
    UINT8   localApicVersion;	 
    UINT8   cpuFlags;		 
    UINT32  cpuSig;		 
    UINT32  featureFlags;	 
    UINT32  reserved[2];
    } MP_CPU;

typedef struct			 
    {
    UINT8  entryType;		 
    UINT8  ioApicId;		 
    UINT8  ioApicVersion;	 
    UINT8  ioApicFlags;		 
    UINT32 ioApicBaseAddress;	 
    } MP_IOAPIC;

 

extern UINT32	loApicBase;		 
extern UINT32	ioApicBase;		 
extern UINT32	ioApicData;		 
extern UINT32	loApicId;		 
extern UINT32	loApicVersion;		 
extern UINT32	loApicMaxLvt;		 




extern void	loApicInit	(void);
extern void	loApicEnable	(BOOL enable);
extern STATUS	loApicIpi	(INT32 apicId, INT32 shortHand, INT32 trigger, 
				 INT32 level, INT32 destMode, INT32 deliMode, 
				 INT32 vectorNo);



















# 85 "pc.h" 2
# 1 "d:/Tornado2.2/target/h/drv/intrCtl/ioApic.h" 1
 

  

 
# 14 "d:/Tornado2.2/target/h/drv/intrCtl/ioApic.h"









 





 







 




 





 



 



 





















 

extern UINT32	ioApicVersion;
extern UINT32	ioApicRedEntries;




extern STATUS   ioApicInit       (void);
extern VOID     ioApicEnable     (BOOL enable);
extern STATUS	ioApicIrqSet	 (INT32 irq, INT32 apicId);
extern STATUS   ioApicRedGet     (INT32 irq, INT32 * pUpper32, INT32 * pLower32);
extern STATUS   ioApicRedSet     (INT32 irq, INT32 upper32, INT32 lower32);
extern INT32    ioApicGet        (UINT32 index, UINT32 data, INT32 offset);
extern void     ioApicSet        (UINT32 index, UINT32 data, INT32 offset, INT32 value);


# 105 "d:/Tornado2.2/target/h/drv/intrCtl/ioApic.h"











# 86 "pc.h" 2











 





 























 

 
# 140 "pc.h"












 






 





 





 


































 










 



 








 



 















 







 



















 



 






# 299 "pc.h"











 


















 



 




















 





















# 167 "config.h" 2


 


    extern void sysHwInit0 (void);
    extern UINT8 sysInumTbl[];		 


 





 












# 204 "config.h"

 













 

 







 








 








 




 









 





 








 



















 


# 311 "config.h"


 











 




















 











 


# 375 "config.h"














# 459 "config.h"


















				 
				 








				 
				 














 






 







 







 







 







 






 

























 


























 











 




 










 
















 










 



















 
# 696 "config.h"




 




 





 

# 1 "configInum.h" 1
 

 

 






 












 


# 41 "configInum.h"


 









# 134 "configInum.h"









































 
































# 714 "config.h" 2





 













# 762 "config.h"












# 33 "sysSerial.c" 2

# 1 "d:/Tornado2.2/target/h/drv/sio/i8250Sio.h" 1
 

 

 



















# 1 "d:/Tornado2.2/target/h/sioLib.h" 1
 

 

 
# 22 "d:/Tornado2.2/target/h/sioLib.h"


# 249 "d:/Tornado2.2/target/h/sioLib.h"

# 26 "d:/Tornado2.2/target/h/drv/sio/i8250Sio.h" 2

 

typedef struct 		 
    {
    SIO_DRV_FUNCS * pDrvFuncs;        

    STATUS      (*getTxChar) ();      
    STATUS      (*putRcvChar) ();     
    void *      getTxArg;
    void *      putRcvArg;

    UINT16  int_vec;                  
    UINT16  channelMode;              
    UCHAR   (*inByte) (int);          
    void    (*outByte)(int,char);     

    ULONG   lcr;                      
    ULONG   lst;                      
    ULONG   mdc;                      
    ULONG   msr;                      
    ULONG   ier;                      
    ULONG   iid;                      
    ULONG   brdl;                     
    ULONG   brdh;                     
    ULONG   data;                     
    ULONG   options;		      
    } I8250_CHAN;



typedef struct			 
    {
    int rate;		 
    int preset;		 
    } BAUD;

 












 






 








 














 






 
 









 













extern void i8250HrdInit(I8250_CHAN *pDev);
extern void i8250Int (I8250_CHAN  *pDev);
















# 35 "sysSerial.c" 2

 

typedef struct
    {
    USHORT vector;
    ULONG  baseAdrs;
    USHORT regSpace;
    USHORT intLevel;
    } I8250_CHAN_PARAS;


 


# 1 "d:/Tornado2.2/target/src/drv/serial/pcConsole.c" 1
 

 
# 1 "d:/Tornado2.2/target/h/copyright_wrs.h" 1
 

# 5 "d:/Tornado2.2/target/src/drv/serial/pcConsole.c" 2

 








 
# 41 "d:/Tornado2.2/target/src/drv/serial/pcConsole.c"

 



# 1 "d:/Tornado2.2/target/h/ioLib.h" 1
 

 

 
# 89 "d:/Tornado2.2/target/h/ioLib.h"


# 343 "d:/Tornado2.2/target/h/ioLib.h"


# 47 "d:/Tornado2.2/target/src/drv/serial/pcConsole.c" 2
# 1 "d:/Tornado2.2/target/h/iosLib.h" 1
 

 

 
# 36 "d:/Tornado2.2/target/h/iosLib.h"


# 131 "d:/Tornado2.2/target/h/iosLib.h"

# 48 "d:/Tornado2.2/target/src/drv/serial/pcConsole.c" 2



# 1 "d:/Tornado2.2/target/h/errnoLib.h" 1
 

 

 
# 25 "d:/Tornado2.2/target/h/errnoLib.h"











 





extern STATUS   errnoOfTaskSet (int taskId, int errorValue);
extern STATUS   errnoSet (int errorValue);
extern int      errnoGet (void);
extern int      errnoOfTaskGet (int taskId);
















# 52 "d:/Tornado2.2/target/src/drv/serial/pcConsole.c" 2
# 1 "config.h" 1
 

 

 
# 145 "config.h"

 





# 762 "config.h"






# 53 "d:/Tornado2.2/target/src/drv/serial/pcConsole.c" 2



 

PC_CON_DEV pcConDv [(2)] ;	 


 

static int	pcConDrvNum;	 


 

static int	pcConDrvOpen ();
static STATUS	pcConDrvIoctl (PC_CON_DEV * pPcCoDv, int request, int arg);
static void	pcConDrvHrdInit ();


 
# 82 "d:/Tornado2.2/target/src/drv/serial/pcConsole.c"

STATUS pcConDrv (void)
    {

     

    if (pcConDrvNum > 0)
	return (0);

    pcConDrvHrdInit ();

    pcConDrvNum = iosDrvInstall (pcConDrvOpen, (FUNCPTR) ((void *)0), pcConDrvOpen,
				(FUNCPTR) ((void *)0), tyRead, tyWrite, pcConDrvIoctl
				 );

    return (pcConDrvNum == (-1) ? (-1) : 0);
    }

 
# 111 "d:/Tornado2.2/target/src/drv/serial/pcConsole.c"

STATUS pcConDevCreate 
    (
    char *	name,		 
    register int	channel,         
    int		rdBufSize,	 
    int		wrtBufSize	 
    )
    {
    register PC_CON_DEV *pPcCoDv;

    if (pcConDrvNum <= 0)
	{
	errnoSet (((12 << 16) | 1));
	return ((-1));
	}

     

    if (channel < 0 || channel >= (2))
        return ((-1));

    pPcCoDv = &pcConDv [channel];

    if (pPcCoDv->created)
	return ((-1));

    if (tyDevInit (&pPcCoDv->tyDev, rdBufSize, wrtBufSize, vgaWriteString)
	!= 0)
	{
	return ((-1));
	}

     
    
    sysIntEnablePIC (0x01);

     

    pPcCoDv->created = 1;
    return (iosDevAdd (&pPcCoDv->tyDev.devHdr, name, pcConDrvNum));
    }

 




static void pcConDrvHrdInit (void)
    {
    register int 	oldlevel;	 

    oldlevel= intLock ();

     

    kbdHrdInit ();

     

    vgaHrdInit ();

     



    intUnlock (oldlevel);

    } 

 





static int pcConDrvOpen 
    (
    PC_CON_DEV *	pPcCoDv,
    char *		name,
    int 		mode
    )
    {
    return ((int) pPcCoDv);
    }

 








static STATUS pcConDrvIoctl 
    (
    PC_CON_DEV *	pPcCoDv,	 
    int 		request,	 
    int 		arg		 
    )
    {
    int 	status = 0;

    switch (request)
	{
        case 1001:
            pPcCoDv->vs->curAttrib = arg ;
	    break;

        case 1002:
            status = pPcCoDv->vs->curAttrib;
	    break;

        case 1003:
            if (arg == 0 || arg == 1)
                pPcCoDv->ks->kbdMode = arg;
            else
                status = (-1);
	    break;

        case 1004:
	    pPcCoDv->vs->rev = (pPcCoDv->vs->rev) ? 0 : 1;
	    pPcCoDv->vs->vgaHook (pPcCoDv->vs, arg, 0);	 
            break;

        case 1005:
	    pPcCoDv->vs->vgaHook (pPcCoDv->vs, arg, 1);	 
	    break;

        case 1006:
	    pPcCoDv->vs->vgaHook (pPcCoDv->vs, arg, 2);  
	    break;

        case 1007:
	    pPcCoDv->vs->vgaHook (pPcCoDv->vs, arg, 3);	 
	    break;

        case 1008:
	    pPcCoDv->vs->vgaHook (pPcCoDv->vs, arg, 4);  
	    break;
	    
	case 1009:		 
	    if ((arg >= 0) && (arg < (2)))
	       pPcCoDv->ks->currCon = arg;
	    break;

	case 1010:		  
	    pPcCoDv->ks->convertChar = arg;
	    break;

	case 1011:			 
	    pPcCoDv->ks->kbdFlags &= ~7;
	    pPcCoDv->ks->kbdFlags |= (arg & 7);
	    pPcCoDv->ks->kbdHook (1);
	    break;

	default:
	    status = tyIoctl (&pPcCoDv->tyDev, request, arg);
	    break;
	}

    return (status);
    }


# 51 "sysSerial.c" 2
# 1 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c" 1
 

 
# 1 "d:/Tornado2.2/target/h/copyright_wrs.h" 1
 

# 5 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c" 2

 
# 15 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c"

 
# 57 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c"

 



# 1 "d:/Tornado2.2/target/h/ioLib.h" 1
 

 

 
# 89 "d:/Tornado2.2/target/h/ioLib.h"


# 343 "d:/Tornado2.2/target/h/ioLib.h"


# 63 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c" 2
# 1 "d:/Tornado2.2/target/h/iosLib.h" 1
 

 

 
# 36 "d:/Tornado2.2/target/h/iosLib.h"


# 131 "d:/Tornado2.2/target/h/iosLib.h"

# 64 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c" 2

# 1 "d:/Tornado2.2/target/h/rngLib.h" 1
 

 

 
# 29 "d:/Tornado2.2/target/h/rngLib.h"


# 165 "d:/Tornado2.2/target/h/rngLib.h"

# 66 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c" 2

# 1 "d:/Tornado2.2/target/h/private/funcBindP.h" 1
 

 

 
# 47 "d:/Tornado2.2/target/h/private/funcBindP.h"











 

extern FUNCPTR     _func_ioTaskStdSet;
extern FUNCPTR     _func_bdall;
extern FUNCPTR     _func_dspTaskRegsShow;
extern VOIDFUNCPTR _func_dspRegsListHook;	 
extern FUNCPTR	   _func_dspMregsHook;		 
extern FUNCPTR     _func_excBaseHook;
extern FUNCPTR     _func_excInfoShow;
extern FUNCPTR     _func_excIntHook;
extern FUNCPTR     _func_excJobAdd;
extern FUNCPTR     _func_excPanicHook;
extern FUNCPTR     _func_fclose;
extern FUNCPTR     _func_fppTaskRegsShow;
extern FUNCPTR     _func_altivecTaskRegsShow;
extern FUNCPTR     _func_ftpLs;
extern FUNCPTR     _func_netLsByName;
extern FUNCPTR     _func_printErr;
extern FUNCPTR     _func_logMsg;
extern FUNCPTR     _func_memalign;
extern FUNCPTR     _func_pthread_setcanceltype;
extern FUNCPTR     _func_selPtyAdd;
extern FUNCPTR     _func_selPtyDelete;
extern FUNCPTR     _func_selTyAdd;
extern FUNCPTR     _func_selTyDelete;
extern FUNCPTR     _func_selWakeupAll;
extern FUNCPTR     _func_selWakeupListInit;
extern FUNCPTR     _func_selWakeupListTerm;
extern VOIDFUNCPTR _func_sigExcKill;
extern FUNCPTR     _func_sigprocmask;
extern FUNCPTR     _func_sigTimeoutRecalc;
extern FUNCPTR     _func_smObjObjShow;
extern FUNCPTR     _func_spy;
extern FUNCPTR     _func_spyStop;
extern FUNCPTR     _func_spyClkStart;
extern FUNCPTR     _func_spyClkStop;
extern FUNCPTR     _func_spyReport;
extern FUNCPTR     _func_spyTask;
extern FUNCPTR     _func_sseTaskRegsShow;
extern FUNCPTR     _func_symFindByValueAndType;    
extern FUNCPTR     _func_symFindByValue;           
extern FUNCPTR     _func_symFindSymbol;
extern FUNCPTR     _func_symNameGet;
extern FUNCPTR     _func_symValueGet;
extern FUNCPTR     _func_symTypeGet;
extern FUNCPTR     _func_taskCreateHookAdd;
extern FUNCPTR     _func_taskDeleteHookAdd;
extern FUNCPTR     _func_valloc;
extern FUNCPTR     _func_remCurIdGet;
extern FUNCPTR     _func_remCurIdSet;

extern FUNCPTR	   _dbgDsmInstRtn;

extern BOOL	   ftpErrorSuppress;
extern BOOL	   _procNumWasSet;

extern VOIDFUNCPTR _func_evtLogO;
extern VOIDFUNCPTR _func_evtLogOIntLock;

extern VOIDFUNCPTR _func_evtLogM0;
extern VOIDFUNCPTR _func_evtLogM1;
extern VOIDFUNCPTR _func_evtLogM2;
extern VOIDFUNCPTR _func_evtLogM3;

extern VOIDFUNCPTR _func_evtLogT0;
extern VOIDFUNCPTR _func_evtLogT0_noInt;
extern VOIDFUNCPTR _func_evtLogT1;
extern VOIDFUNCPTR _func_evtLogT1_noTS;
extern VOIDFUNCPTR _func_evtLogTSched;

extern VOIDFUNCPTR _func_evtLogString;
extern FUNCPTR     _func_evtLogPoint;
extern FUNCPTR	   _func_evtLogReserveTaskName;


# 141 "d:/Tornado2.2/target/h/private/funcBindP.h"

extern FUNCPTR     _func_tmrStamp;
extern FUNCPTR     _func_tmrStampLock;
extern FUNCPTR     _func_tmrFreq;
extern FUNCPTR     _func_tmrPeriod;
extern FUNCPTR     _func_tmrConnect;
extern FUNCPTR     _func_tmrEnable;
extern FUNCPTR     _func_tmrDisable;

extern VOIDFUNCPTR _func_trgCheck;
extern UINT32 evtAction;
extern UINT32 wvEvtClass;
extern UINT32 trgEvtClass;

extern BOOL   wvInstIsOn;              
extern BOOL   wvObjIsEnabled;          







# 68 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c" 2

# 1 "d:/Tornado2.2/target/h/taskLib.h" 1
 

 

 
# 126 "d:/Tornado2.2/target/h/taskLib.h"









# 1 "d:/Tornado2.2/target/h/vwModNum.h" 1
 

 

 
# 94 "d:/Tornado2.2/target/h/vwModNum.h"


# 253 "d:/Tornado2.2/target/h/vwModNum.h"

# 136 "d:/Tornado2.2/target/h/taskLib.h" 2



# 1 "d:/Tornado2.2/target/h/excLib.h" 1
 

 

 
# 51 "d:/Tornado2.2/target/h/excLib.h"

















































# 1 "d:/Tornado2.2/target/h/arch/i86/excI86Lib.h" 1
 

 

 
# 14 "d:/Tornado2.2/target/h/arch/i86/excI86Lib.h"








 







typedef struct
    {
    UINT16 valid;	 
    UINT16 vecNum;	 
    ULONG errCode;	 
    INSTR * pc;		 
    ULONG eflags;	 
    UINT16 cs;		 
    UINT16 pad;		 
    ULONG esp;		 
    ULONG ss;		 
    ULONG esp0;		 
    ULONG cr2;		 
    ULONG cr3;		 
    ULONG esp00;	 
    ULONG esp01;	 
    ULONG esp02;	 
    ULONG esp03;	 
    ULONG esp04;	 
    ULONG esp05;	 
    ULONG esp06;	 
    ULONG esp07;	 
    ULONG reserved0;	 
    ULONG reserved1;	 
    ULONG reserved2;	 
    ULONG reserved3;	 
    } EXC_INFO;

 








 

extern FUNCPTR  excExcepHook;    

 



extern void	excStub (void);
extern void	excIntStub (void);
















# 101 "d:/Tornado2.2/target/h/excLib.h" 2

















typedef struct  excfaultTab
    {
    int faultType;		 
    int subtype;		 
    int signal;			 
    int code;			 
    } EXC_FAULT_TAB;

 


extern STATUS 	excShowInit (void);
extern void 	excHookAdd (FUNCPTR excepHook);
extern STATUS 	excJobAdd (VOIDFUNCPTR func, int arg1, int arg2, int arg3,
			   int arg4, int arg5, int arg6);















# 140 "d:/Tornado2.2/target/h/taskLib.h" 2
# 1 "d:/Tornado2.2/target/h/private/eventP.h" 1
 

 

 
# 80 "d:/Tornado2.2/target/h/private/eventP.h"








 

 







 





































 



typedef unsigned short event_t;





















































 












# 215 "d:/Tornado2.2/target/h/private/eventP.h"

 

 










 












 
















 

















 


















 
# 307 "d:/Tornado2.2/target/h/private/eventP.h"


# 326 "d:/Tornado2.2/target/h/private/eventP.h"

 
# 338 "d:/Tornado2.2/target/h/private/eventP.h"


# 357 "d:/Tornado2.2/target/h/private/eventP.h"

 
# 367 "d:/Tornado2.2/target/h/private/eventP.h"


# 381 "d:/Tornado2.2/target/h/private/eventP.h"

 

















 
















 








# 436 "d:/Tornado2.2/target/h/private/eventP.h"


 
















 
















 








# 493 "d:/Tornado2.2/target/h/private/eventP.h"

 








# 515 "d:/Tornado2.2/target/h/private/eventP.h"

 








# 536 "d:/Tornado2.2/target/h/private/eventP.h"

 








# 559 "d:/Tornado2.2/target/h/private/eventP.h"

 








# 580 "d:/Tornado2.2/target/h/private/eventP.h"

 








# 601 "d:/Tornado2.2/target/h/private/eventP.h"

 
















 








# 636 "d:/Tornado2.2/target/h/private/eventP.h"

 








# 655 "d:/Tornado2.2/target/h/private/eventP.h"

 








# 675 "d:/Tornado2.2/target/h/private/eventP.h"

 








# 693 "d:/Tornado2.2/target/h/private/eventP.h"


















 














































 

 


     





     





     




 


     
# 792 "d:/Tornado2.2/target/h/private/eventP.h"



     





     





     
# 816 "d:/Tornado2.2/target/h/private/eventP.h"


     
# 827 "d:/Tornado2.2/target/h/private/eventP.h"



     






     





      





     

 


     
# 863 "d:/Tornado2.2/target/h/private/eventP.h"


     







     






     








     






     







     







     







     








     








     









     









     








     








     








     








     






     






     







     






     









     






     









     
# 1059 "d:/Tornado2.2/target/h/private/eventP.h"


     







     






     






     







     





     







     








     







     






     








     






     





     





 


     






     





     





     





     








     







     





     




     





     





     





     





     





     





     





     




     





     





     





     





     





     





     





     





     





     





     





     





     





     





     




     




 


     







     






     







     







     




     





     





     





     





     






     






 




     





     




     























 








# 1494 "d:/Tornado2.2/target/h/private/eventP.h"











 
# 1522 "d:/Tornado2.2/target/h/private/eventP.h"














# 141 "d:/Tornado2.2/target/h/taskLib.h" 2



# 1 "d:/Tornado2.2/target/h/stdlib.h" 1
 

 

 
# 37 "d:/Tornado2.2/target/h/stdlib.h"


















# 65 "d:/Tornado2.2/target/h/stdlib.h"

 















typedef struct { int quot; int rem; } div_t;




typedef struct { long quot; long rem; } ldiv_t;



typedef struct {		 
	unsigned char __state;
	unsigned short __wchar;
	} _Mbsave;



extern void	abort (void);
extern int	abs (int __i);
extern int	atexit (void (*__func)(void));
extern double	atof (const char *__s);
extern int	atoi (const char *__s);
extern long	atol (const char *__s);
extern void *	bsearch (const void *__key, const void *__base,
		         size_t __nelem, size_t __size,
		         int  (*__cmp)(const void *__ck, const void *__ce));
extern div_t	div (int __numer, int __denom);
extern long	labs (long __i);
extern ldiv_t	ldiv (long __numer, long __denom);
extern int	mblen (const char *__s, size_t __n);
extern size_t	mbstowcs (wchar_t *__wcs, const char *__s, size_t __n);
extern int	mbtowc (wchar_t *__pwc, const char *__s, size_t __n);
extern void	qsort (void *__base, size_t __nelem, size_t __size,
		       int  (*__cmp)(const void *__e1, const void *__e2));
extern int	rand (void);
extern void *	srand (unsigned int __seed);
extern double	strtod (const char *__s, char **__endptr);
extern long	strtol (const char *__s, char **__endptr, int __base);
extern unsigned long strtoul (const char *__s, char **__endptr, int __base);
extern int	system (const char *__s);
extern size_t	wcstombs (char *__s, const wchar_t *__wcs, size_t __n);
extern int	wctomb (char *__s, wchar_t __wchar);

extern void *	calloc (size_t __nelem, size_t __size);
extern void	exit (int __status);
extern void	free (void *__ptr);
extern char *	getenv (const char *__name);
extern void *	malloc (size_t __size);
extern void *	realloc (void *__ptr, size_t __size);



extern void     div_r (int numer, int denom, div_t * divStructPtr);
extern void     ldiv_r (long numer, long denom, ldiv_t * divStructPtr);




# 178 "d:/Tornado2.2/target/h/stdlib.h"









# 145 "d:/Tornado2.2/target/h/taskLib.h" 2


 












 







 













 







typedef struct wdb_info		 
    {
    int			wdbState;	 
    REG_SET *		wdbRegisters;	 
    struct
        {
	void *	wdb1;
	void *	wdb2;
	} wdbEvtList;			 
    int			bpAddr;		 
					 
    int			taskBpAddr;	 
    int			taskPc;		 
    int			taskFp;		 
    int			taskSp;		 
    VOIDFUNCPTR		wdbExitHook;	 
  } WDB_INFO;

typedef struct windTcb		 
    {
    Q_NODE		qNode;		 
    Q_NODE		tickNode;	 
    Q_NODE		activeNode;	 

    OBJ_CORE		objCore;	 
    char *		name;		 
    int			options;	 
    UINT		status;		 
    UINT		priority;	 
    UINT		priNormal;	 
    UINT		priMutexCnt;	 
    struct semaphore *	pPriMutex;	 

    UINT		lockCnt;	 
    UINT		tslice;		 

    UINT16		swapInMask;	 
    UINT16		swapOutMask;	 

    Q_HEAD *		pPendQ;		 

    UINT		safeCnt;	 
    Q_HEAD		safetyQHead;	 

    FUNCPTR		entry;		 

    char *		pStackBase;	 
    char *		pStackLimit;	 
    char *		pStackEnd;	 

    int			errorStatus;	 
    int			exitCode;	 

    struct sigtcb *	pSignalInfo;	 
    struct selContext *	pSelectContext;	 

    UINT		taskTicks;	 
    UINT		taskIncTicks;	 

    struct taskVar *	pTaskVar;	 
    struct rpcModList *	pRPCModList;	 
    struct fpContext *	pFpContext;	 

    struct __sFILE *	taskStdFp[3];	 
    int			taskStd[3];	 

    char **		ppEnviron;	 
    int                 envTblSize;      
    int                 nEnvVarEntries;  
    struct sm_obj_tcb *	pSmObjTcb;	 
    int			windxLock;	 
    void *		pComLocal;	 
    REG_SET *		pExcRegSet;	 
    EVENTS		events;		 
    WDB_INFO *		pWdbInfo;	 
    void *		pPthread;	 
    int			reserved1;	 
    int			reserved2;	 
    int			spare1;		 
    int			spare2;		 
    int			spare3;		 
    int			spare4;		 

     


# 284 "d:/Tornado2.2/target/h/taskLib.h"









































# 336 "d:/Tornado2.2/target/h/taskLib.h"










# 357 "d:/Tornado2.2/target/h/taskLib.h"


    EXC_INFO            excInfo;         

     

    REG_SET             regs;            











# 384 "d:/Tornado2.2/target/h/taskLib.h"

    struct dspContext *	pDspContext;	 
    WDB_INFO		wdbInfo;	 
    } WIND_TCB;

typedef struct 			 
    {
    int			td_id;		 
    char *		td_name;	 
    int			td_priority;	 
    int			td_status;	 
    int			td_options;	 
    FUNCPTR		td_entry;	 
    char *		td_sp;		 
    char *		td_pStackBase;	 
    char *		td_pStackLimit;	 
    char *		td_pStackEnd;	 
    int			td_stackSize;	 
    int			td_stackCurrent; 
    int			td_stackHigh;	 
    int			td_stackMargin;	 
    int			td_errorStatus;	 
    int			td_delay;	 
    EVENTS		td_events;	 
    } TASK_DESC;





 
# 426 "d:/Tornado2.2/target/h/taskLib.h"







 
# 442 "d:/Tornado2.2/target/h/taskLib.h"










 













 
# 475 "d:/Tornado2.2/target/h/taskLib.h"


# 486 "d:/Tornado2.2/target/h/taskLib.h"

 














 

extern CLASS_ID	taskClassId;		 
extern CLASS_ID taskInstClassId;  	 
extern WIND_TCB *taskIdCurrent;		 
extern BOOL     taskPriRangeCheck;       

 



extern STATUS 	taskLibInit (void);





extern int 	taskSpawn (char *name, int priority, int options, int stackSize,
		      	   FUNCPTR entryPt, int arg1, int arg2, int arg3,
		      	   int arg4, int arg5, int arg6, int arg7,
		      	   int arg8, int arg9, int arg10);


extern STATUS 	taskInit (WIND_TCB *pTcb, char *name, int priority, int options,
			  char *pStackBase, int stackSize, FUNCPTR entryPt,
			  int arg1, int arg2, int arg3, int arg4, int arg5,
			  int arg6, int arg7, int arg8, int arg9, int arg10);
extern STATUS 	taskActivate (int tid);
extern STATUS 	taskDelete (int tid);
extern STATUS 	taskDeleteForce (int tid);
extern STATUS 	taskSuspend (int tid);
extern STATUS 	taskResume (int tid);
extern STATUS 	taskRestart (int tid);
extern STATUS 	taskPrioritySet (int tid, int newPriority);
extern STATUS 	taskPriorityGet (int tid, int *pPriority);
extern STATUS 	taskLock (void);
extern STATUS 	taskUnlock (void);
extern STATUS 	taskSafe (void);
extern STATUS 	taskUnsafe (void);
extern STATUS 	taskDelay (int ticks);
extern STATUS 	taskOptionsSet (int tid, int mask, int newOptions);
extern STATUS 	taskOptionsGet (int tid, int *pOptions);
extern char *	taskName (int tid);
extern int 	taskNameToId (char *name);
extern STATUS 	taskIdVerify (int tid);
extern int 	taskIdSelf (void);
extern int 	taskIdDefault (int tid);
extern BOOL 	taskIsReady (int tid);
extern BOOL 	taskIsSuspended (int tid);
extern WIND_TCB *taskTcb (int tid);
extern int 	taskIdListGet (int idList [ ], int maxTasks);
extern STATUS 	taskInfoGet (int tid, TASK_DESC *pTaskDesc);
extern STATUS 	taskStatusString (int tid, char *pString);
extern STATUS 	taskOptionsString (int tid, char *pString);
extern STATUS 	taskRegsGet (int tid, REG_SET *pRegs);
extern STATUS 	taskRegsSet (int tid, REG_SET *pRegs);
extern void 	taskRegsShow (int tid);
extern void *	taskStackAllot (int tid, unsigned nBytes);
extern void 	taskShowInit (void);
extern STATUS 	taskShow (int tid, int level);


# 602 "d:/Tornado2.2/target/h/taskLib.h"









# 70 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c" 2

# 1 "d:/Tornado2.2/target/h/stdio.h" 1
 

 
 

 
# 49 "d:/Tornado2.2/target/h/stdio.h"















# 1 "d:/Tornado2.2/host/x86-win32/lib/gcc-lib/i586-wrs-vxworks/2.9-PentiumIII-010221/include/stdarg.h" 1 3
 
# 19 "d:/Tornado2.2/host/x86-win32/lib/gcc-lib/i586-wrs-vxworks/2.9-PentiumIII-010221/include/stdarg.h" 3

 






 











 



typedef __builtin_va_list __gnuc_va_list;


 



 












 
 














# 96 "d:/Tornado2.2/host/x86-win32/lib/gcc-lib/i586-wrs-vxworks/2.9-PentiumIII-010221/include/stdarg.h" 3

 




 

 

 

typedef __gnuc_va_list va_list;

























# 65 "d:/Tornado2.2/target/h/stdio.h" 2



# 78 "d:/Tornado2.2/target/h/stdio.h"

 

struct __sbuf 			 
    {
    uchar_t * _base;		 
    int	      _size;		 
    };

typedef	struct __sFILE
    {
    OBJ_CORE		objCore;	 
    uchar_t *		_p;		 
    int			_r;		 
    int			_w;		 
    short		_flags;		 
    short		_file;		 
    struct __sbuf	_bf;		 
    int			_lbfsize;	 
    struct __sbuf	_ub;		 
    uchar_t *		_up;		 
    int			_ur;		 
    uchar_t		_ubuf[3];	 
    uchar_t		_nbuf[1];	 
    struct __sbuf	_lb;		 
    int			_blksize;	 
    int			_offset;	 
    int			taskId;		 
    } FILE;

 

extern CLASS_ID fpClassId;		 

 

























































extern void	clearerr (FILE *);
extern int	fclose (FILE *);
extern int	feof (FILE *);
extern int	ferror (FILE *);
extern int	fflush (FILE *);
extern int	fgetc (FILE *);
extern int	fgetpos (FILE *, fpos_t *);
extern char *	fgets (char *, size_t, FILE *);
extern FILE *	fopen (const char *, const char *);
extern int	fprintf (FILE *, const char *, ...);
extern int	fputc (int, FILE *);
extern int	fputs (const char *, FILE *);
extern int	fread (void *, size_t, size_t, FILE *);
extern FILE *	freopen (const char *, const char *, FILE *);
extern int	fscanf (FILE *, const char *, ...);
extern int	fseek (FILE *, long, int);
extern int	fsetpos (FILE *, const fpos_t *);
extern long	ftell (FILE *);
extern int	fwrite (const void *, size_t, size_t, FILE *);
extern int	getc (FILE *);
extern int	getchar (void);
extern char *	gets (char *);
extern void	perror (const char *);
extern int	printf (const char *, ...);
extern int	putc (int, FILE *);
extern int	putchar (int);
extern int	puts (const char *);
extern int	remove (const char *);
extern int	rename  (const char *, const char *);
extern void	rewind (FILE *);
extern int	scanf (const char *, ...);
extern void	setbuf (FILE *, char *);
extern int	setvbuf (FILE *, char *, int, size_t);
extern int	sprintf (char *, const char *, ...);
extern int	sscanf (const char *, const char *, ...);
extern FILE *	tmpfile (void);
extern char *	tmpnam (char *);
extern int	ungetc (int, FILE *);
extern int	vfprintf (FILE *, const char *, va_list);
extern int	vprintf (const char *, va_list);
extern int	vsprintf (char *, const char *, va_list);
extern int	__srget (FILE *);		 
extern int	__swbuf (int, FILE *);		 

 

extern FILE *	fdopen (int, const char *);
extern int	fileno (FILE *);

 

 



extern int	fdprintf (int fd, const char *fmt, ...);
extern int	vfdprintf (int fd, const char *fmt, va_list ap);
extern int	printErr (const char *fmt, ...);
extern int	getw (FILE *);
extern int	putw (int, FILE *);
extern void	setbuffer (FILE *, char *, int);
extern int	setlinebuf (FILE *);
extern FILE *   stdioFp (int std);
extern STATUS   stdioShow (FILE * fp, int level);
extern STATUS   stdioShowInit (void);
extern STATUS   stdioInit (void);




# 311 "d:/Tornado2.2/target/h/stdio.h"


 


extern FILE **	__stdin(void);		 
extern FILE **	__stdout(void);		 
extern FILE **	__stderr(void);		 











 











































# 72 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c" 2
# 1 "d:/Tornado2.2/target/h/string.h" 1
 

 

 
# 19 "d:/Tornado2.2/target/h/string.h"











# 40 "d:/Tornado2.2/target/h/string.h"



extern void *	memchr (const void *__s, int __c, size_t __n);
extern int 	memcmp (const void *__s1, const void *__s2, size_t __n);
extern void *	memcpy (void *__s1, const void *__s2, size_t __n);
extern void *	memmove (void *__s1, const void *__s2, size_t __n);
extern void *	memset (void *__s, int __c, size_t __n);

extern char *	strcat (char *__s1, const char *__s2);
extern char *	strchr (const char *__s, int __c);
extern int 	strcmp (const char *__s1, const char *__s2);
extern int 	strcoll (const char *__s1, const char *__s2);
extern char *	strcpy (char *__s1, const char *__s2);
extern size_t 	strcspn (const char *__s1, const char *__s2);
extern size_t 	strlen (const char *__s);
extern char *	strncat (char *__s1, const char *__s2, size_t __n);
extern int 	strncmp (const char *__s1, const char *__s2, size_t __n);
extern char *	strncpy (char *__s1, const char *__s2, size_t __n);
extern char *	strpbrk (const char *__s1, const char *__s2);
extern char *	strrchr (const char *__s, int __c);
extern size_t 	strspn (const char *__s1, const char *__s2);
extern char *	strstr (const char *__s1, const char *__s2);
extern char *	strtok (char *__s, const char *__sep);
extern size_t 	strxfrm (char *__s1, const char *__s2, size_t __n);
extern char *	strerror(int __errcode);


extern char *	strtok_r (char *__s, const char *__sep, char **__ppLast);



extern int	strerror_r (int __errcode, char *__buf);
extern void 	bcopy (const char *source, char *dest, int nbytes);
extern void 	bcopyBytes (char *source, char *dest, int nbytes);
extern void 	bcopyWords (char *source, char *dest, int nwords);
extern void 	bcopyLongs (char *source, char *dest, int nlongs);
extern void 	bfill (char *buf, int nbytes, int ch);
extern void 	bfillBytes (char *buf, int nbytes, int ch);
extern void 	bzero (char *buffer, int nbytes);
extern int 	bcmp (char *buf1, char *buf2, int nbytes);
extern void 	binvert (char *buf, int nbytes);
extern void 	bswap (char *buf1, char *buf2, int nbytes);
extern void 	uswab (char *source, char *destination, int nbytes);
extern void 	swab (char *source, char *dest, int nbytes);
extern char *	index (const char *s, int c);
extern char *	rindex (const char *s, int c);



# 138 "d:/Tornado2.2/target/h/string.h"







# 73 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c" 2
# 1 "config.h" 1
 

 

 
# 145 "config.h"

 





# 762 "config.h"






# 74 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c" 2



 

extern PC_CON_DEV	pcConDv [(2)] ;


 

static VGA_CON_DEV	vgaConDv [(2)];
static UCHAR		curSt,curEd;		 
static int 		tyWrtThreshold  = 20;	 


static int 		jobaddThreshold = 20;	 
static UCHAR * vgaCharTable [] = 
    {
     
    (unsigned char *)
    "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
    "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
    " !\"#$%&'()*+,-./0123456789:;<=>?"
    "@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_"
    "`abcdefghijklmnopqrstuvwxyz{|}~\0"
    "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
    "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
    "\040\255\233\234\376\235\174\025\376\376\246\256\252\055\376\376"
    "\370\361\375\376\376\346\024\371\376\376\247\257\254\253\376\250"
    "\376\376\376\376\216\217\222\200\376\220\376\376\376\376\376\376"
    "\376\245\376\376\376\376\231\376\235\376\376\376\232\376\376\341"
    "\205\240\203\376\204\206\221\207\212\202\210\211\215\241\214\213"
    "\376\244\225\242\223\376\224\366\233\227\243\226\201\376\376\230",
     
    (unsigned char *)
    "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
    "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
    " !\"#$%&'()*+,-./0123456789:;<=>?"
    "@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ "
    "\004\261\007\007\007\007\370\361\040\007\331\277\332\300\305\007"
    "\007\304\007\007\303\264\301\302\263\007\007\007\007\007\234\0"
    "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
    "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
    "\040\255\233\234\376\235\174\025\376\376\246\256\252\055\376\376"
    "\370\361\375\376\376\346\024\371\376\376\247\257\254\253\376\250"
    "\376\376\376\376\216\217\222\200\376\220\376\376\376\376\376\376"
    "\376\245\376\376\376\376\231\376\376\376\376\376\232\376\376\341"
    "\205\240\203\376\204\206\221\207\212\202\210\211\215\241\214\213"
    "\376\244\225\242\223\376\224\366\376\227\243\226\201\376\376\230",
     
    (unsigned char *)
    "\000\001\002\003\004\005\006\007\010\011\000\013\000\000\000\000"
    "\020\021\022\023\024\025\026\027\030\031\032\000\034\035\036\037"
    "\040\041\042\043\044\045\046\047\050\051\052\053\054\055\056\057"
    "\060\061\062\063\064\065\066\067\070\071\072\073\074\075\076\077"
    "\100\101\102\103\104\105\106\107\110\111\112\113\114\115\116\117"
    "\120\121\122\123\124\125\126\127\130\131\132\133\134\135\136\137"
    "\140\141\142\143\144\145\146\147\150\151\152\153\154\155\156\157"
    "\160\161\162\163\164\165\166\167\170\171\172\173\174\175\176\177"
    "\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217"
    "\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237"
    "\240\241\242\243\244\245\246\247\250\251\252\253\254\255\256\257"
    "\260\261\262\263\264\265\266\267\270\271\272\273\274\275\276\277"
    "\300\301\302\303\304\305\306\307\310\311\312\313\314\315\316\317"
    "\320\321\322\323\324\325\326\327\330\331\332\333\334\335\336\337"
    "\340\341\342\343\344\345\346\347\350\351\352\353\354\355\356\357"
    "\360\361\362\363\364\365\366\367\370\371\372\373\374\375\376\377"
    };


 

static void	vgaStatInit (void);
static void	vgaHook (register VGA_CON_DEV *  pVgaConDv, int arg, int opCode);
static void	vgaClear (register VGA_CON_DEV *  pVgaConDv, int position, 
			  UCHAR eraseChar);
static void	vgaScroll (register VGA_CON_DEV *  pVgaConDv, int pos, int line, 
			   BOOL upDn, register UCHAR atr);
static void	vgaInsertChar (register VGA_CON_DEV *  pVgaConDv, 
			       register int nInsChar);
static void 	vgaCursorOn (void);
static void	vgaCursorOff (void);
static void	vgaCursorPos (register UINT16 pos);
static void	vgaScreenRev (register VGA_CON_DEV * pVgaConDv);
static void	vgaDelLeftChar (register VGA_CON_DEV *  pVgaConDv);
static void	vgaCarriageReturn (register VGA_CON_DEV *  pVgaConDv);
static void	vgaBackSpace (register VGA_CON_DEV *  pVgaConDv);
static void	vgaLineFeed (register VGA_CON_DEV *  pVgaConDv);
static void	vgaTab (register VGA_CON_DEV *  pVgaConDv);
static void	vgaConBeep (BOOL mode);



static UCHAR vgaColorTable [] = 
    {
     
           0,   4,     2,     6,    1,       5,    3,          7
    };
static void	vgaEscResponse (register PC_CON_DEV * pPcCoDv, int  responseId );
static void	vgaPutCursor (register VGA_CON_DEV *  pVgaConDv);
static void	vgaSaveCurAttrib (register VGA_CON_DEV *  pVgaConDv);
static void	vgaRestAttrib (register VGA_CON_DEV *  pVgaConDv);
static void	vgaSetMode (register  PC_CON_DEV *  pPcCoDv, BOOL onOff);
static void	vgaClearLine (register VGA_CON_DEV *  pVgaConDv);
static void	vgaInsertLine (register VGA_CON_DEV *  pVgaConDv);
static void	vgaSetAttrib (register VGA_CON_DEV *  pVgaConDv);
static void	vgaDelLines (register VGA_CON_DEV *  pVgaConDv);
static void	vgaDelRightChars (register VGA_CON_DEV *  pVgaConDv, int nDelChar);



 
# 195 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c"

static void vgaConBeep 
    (
    BOOL	mode	 
    )
    {
    int		beepTime;
    int		beepPitch;
    register int 	oldlevel;

    if (mode)
        { 
        beepPitch = 1280;
        beepTime  = (sysClkRateGet () / 3);	 
        }
    else
        { 
        beepPitch = 1208;
        beepTime  = (sysClkRateGet () / 8);	 
        }

    oldlevel = intLock ();

     

    sysOutByte (0x40 + 3, 0xb6);	
    sysOutByte (0x40 + 2, (beepPitch & 0xff));
    sysOutByte (0x40 + 2, (beepPitch >> 8));

     
    sysOutByte (0x61, sysInByte (0x61) | 0x03);	

    taskDelay (beepTime);

     
    sysOutByte (0x61, sysInByte (0x61) & ~0x03);

    intUnlock (oldlevel);
    return;
    }

 
# 246 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c"

void vgaHrdInit (void)
    {

     

    sysOutByte ((int) (UCHAR *) 0x3d4, 0x0a);
    curSt = sysInByte ((int) (UCHAR *) 0x3d5);
    sysOutByte ((int) (UCHAR *) 0x3d4, 0x0b);
    curEd = sysInByte ((int) (UCHAR *) 0x3d5);

    vgaStatInit ();

     

    vgaClear (pcConDv [(0)].vs, 2,' ');
    vgaCursorOn ();
    return;
    } 

 






static void vgaStatInit (void)
    {
    int		ix;			 
    register VGA_CON_DEV * pVgaConDv;	 

    for (ix = 0; ix < (2); ix++)
	{
	pcConDv [ix].vs	= pVgaConDv = &vgaConDv [ix];

	 
	pVgaConDv->memBase	 = (UCHAR *) 0xb8000;
	pVgaConDv->colorMode     = 1;          
	pVgaConDv->sv_col        = pVgaConDv->col   = 0;
	pVgaConDv->sv_row        = pVgaConDv->row   = 0;
	pVgaConDv->sv_curAttrib  = pVgaConDv->curAttrib = (0x07   | 0x08) | 0x10;
	pVgaConDv->defAttrib     = (0x07   | 0x08) | 0x10;
	pVgaConDv->curChrPos     = pVgaConDv->memBase;   
	pVgaConDv->sv_rev        = pVgaConDv->rev   = 0;
	pVgaConDv->ncol          = 80;                 
	pVgaConDv->nrow          = 25;                 
	pVgaConDv->scst          = 0;                  
	pVgaConDv->sced          = 24;                 
	pVgaConDv->autoWrap      = 1;               
	pVgaConDv->scrollCheck   = 0;              
	pVgaConDv->charSet       = vgaCharTable [0];  
	pVgaConDv->vgaMode       = 0;          
	pVgaConDv->insMode       = 0;    
	pVgaConDv->escFlags      = 0x0001;         
	pVgaConDv->escParaCount  = 0;                  
	pVgaConDv->escQuestion   = 0;              
	bzero ((char *)pVgaConDv->escPara, sizeof(pVgaConDv->escPara));
	bzero (pVgaConDv->tab_stop, sizeof(pVgaConDv->tab_stop));
	pVgaConDv->tab_stop [ 0] = 1;
	pVgaConDv->tab_stop [ 8] = 1;
	pVgaConDv->tab_stop [16] = 1;
	pVgaConDv->tab_stop [24] = 1;
	pVgaConDv->tab_stop [32] = 1;
	pVgaConDv->tab_stop [40] = 1;
	pVgaConDv->tab_stop [48] = 1;
	pVgaConDv->tab_stop [56] = 1;
	pVgaConDv->tab_stop [64] = 1;
	pVgaConDv->tab_stop [72] = 1;
	pVgaConDv->vgaHook	 = (FUNCPTR) vgaHook;	 
	}
    return;
    } 

 
# 331 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c"

static void vgaHook 
    (
    register VGA_CON_DEV *  pVgaConDv,       
    int			arg,		 
    int			opCode		 
    )
    {
    switch (opCode)
	{
	case 0:
	      vgaScreenRev (pVgaConDv);  
	      break;
	case 1:
	      vgaConBeep (arg);		 
	      break;
	case 2:
	      vgaCursorOn ();		 
	      break;
	case 3:
	      vgaCursorOff ();		 
	      break;
	case 4:				 
	      pVgaConDv->row = (arg >> 8) & 0xff;
	      pVgaConDv->col = arg & 0xff;
	      if (pVgaConDv->row >= pVgaConDv->nrow)
	      pVgaConDv->row = pVgaConDv->nrow - 1;
	      if (pVgaConDv->col >= pVgaConDv->ncol)
	      pVgaConDv->col = pVgaConDv->ncol - 1;
	      vgaCursorPos ((UINT16) (pVgaConDv->row * pVgaConDv->ncol 
				      + pVgaConDv->col));
	      break;
	default:
	      break;
	}
    }

 
# 380 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c"

static void vgaClear 
    (
    register VGA_CON_DEV *	pVgaConDv,	 
    int			position,	 
    UCHAR		eraseChar	 
    )
    {
    register UINT16 *	cp;	 
    register UINT16 *	end;	 
    register UINT16 	erase;	 

    erase = (pVgaConDv->defAttrib << 8) + eraseChar;
    if ( position == 2 )
	{ 
	cp  = (UINT16 *) pVgaConDv->memBase;
	end = (UINT16 *) (pVgaConDv->memBase + 2048 * 2);
	pVgaConDv->col = pVgaConDv->row = 0;
	pVgaConDv->curChrPos = (UCHAR *) pVgaConDv->memBase;
	}
    else if ( position == 0 )
	{ 
	cp  = (UINT16 *)pVgaConDv->curChrPos;
	end = (UINT16 *)(pVgaConDv->memBase + 2048 * 2);
	}
    else  
	{
	cp  = (UINT16 *) pVgaConDv->memBase;
	end = (UINT16 *) (pVgaConDv->curChrPos + 2);
	}
    for (; cp < end; cp++ )
        {
        *cp     = erase;  
        }
    }

 






static void vgaScreenRev 
    (
    register VGA_CON_DEV * pVgaConDv	 
    )
    {
    UCHAR *	cp;	 
    UCHAR	atr;	 

    for (cp = pVgaConDv->memBase; cp < pVgaConDv->memBase + 2000 * 2; 
	 cp += 2)
        {
        atr = *(cp+1);
        *(cp+1)  = atr & 0x88;
        *(cp+1) |= (atr << 4) & 0x70;
        *(cp+1) |= (atr >> 4) & 0x07;
        }
    }

 
# 450 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c"

static void vgaScroll 
    (
    register VGA_CON_DEV *	pVgaConDv,	 
    int			pos,		 
    int			lines,		 
    BOOL		upDn,		 
    register UCHAR		atr		 
    )
    {
    register UCHAR *	dest;	 
    register UCHAR *	src;	 

    if (pos < pVgaConDv->scst || pos > pVgaConDv->sced)
        return;

    if (upDn)
        {
	 

        if (pVgaConDv->scst + lines > pVgaConDv->sced + 1)
            lines = pVgaConDv->sced - pVgaConDv->scst + 1;

        for (dest = pVgaConDv->memBase + pVgaConDv->ncol * 2 * 
	     pVgaConDv->scst, src = pVgaConDv->memBase + pVgaConDv->ncol * 
	     2 * (pVgaConDv->scst + lines); src < pVgaConDv->memBase + 
	     pVgaConDv->ncol * 2 * (pos + 1); *dest++ = *src++ );

        for (dest = pVgaConDv->memBase + pVgaConDv->ncol * 2 * 
	     (pos - (lines - 1)); dest < pVgaConDv->memBase + pVgaConDv->ncol *
	     2 * (pos + 1); dest += 2 )
            {
            *dest     = ' ';
            *(dest+1) = atr;
            }
        }
    else
        {
	 

        if (pVgaConDv->scst + lines > pVgaConDv->sced + 1)
            lines = pVgaConDv->sced - pVgaConDv->scst + 1;

        for (dest = pVgaConDv->memBase + pVgaConDv->ncol * 2 * 
	     (pVgaConDv->sced + 1) - 1, src = pVgaConDv->memBase + 
	     pVgaConDv->ncol * 2 * (pVgaConDv->sced - (lines - 1)) - 1;
             src > pVgaConDv->memBase + pVgaConDv->ncol * 2 * pos - 1;
             *dest-- = *src-- );

        for (dest = pVgaConDv->memBase + pVgaConDv->ncol * 2 * 
	     (pos + lines) - 1; dest > pVgaConDv->memBase + pVgaConDv->ncol * 
	     2 * pos - 1;
             dest -= 2 )
            {
            *dest     = atr;
            *(dest-1) = ' ';
            }
        }
    return;
    }

 






static void vgaInsertChar
    (
    register VGA_CON_DEV *	pVgaConDv,	 
    register int		nInsChar	 
    )
    {
    register int		xPos ;   
    register UINT16   	erase;	 
    register UINT16   	swap;	 
    register UINT16 *	chrPos;	 

    if (nInsChar > pVgaConDv->ncol)
	nInsChar = pVgaConDv->ncol;

    else if (nInsChar == 0) 
	nInsChar = 1;
    
    while (nInsChar-- != 0)
	{
	xPos   = pVgaConDv->col;
	chrPos = (UINT16 *) pVgaConDv->curChrPos;
	erase  = (pVgaConDv->defAttrib << 8) + ' ' ; 

	while (xPos++ < pVgaConDv->ncol)
	    {
	     

	    swap    = *chrPos;
	    *chrPos = erase ; 
	    erase   = swap;   
	    chrPos++;
	    }
	}
    }

 






static void vgaDelLeftChar 
    (
    register VGA_CON_DEV *	pVgaConDv	 
    )
    {
    register UINT16		erase;	 

    erase = (pVgaConDv->defAttrib << 8) + ' ' ;
    if (pVgaConDv->autoWrap || pVgaConDv->ncol > 0)
	{
	pVgaConDv->col--;
	pVgaConDv->curChrPos -= 2;
	}
    *(UINT16 *)pVgaConDv->curChrPos = erase;

    }

 






static void vgaCarriageReturn 
    (
    register VGA_CON_DEV *	pVgaConDv	 
    )
    {

    pVgaConDv->curChrPos -= pVgaConDv->col * 2;
    pVgaConDv->col = 0;

    }

 






static void vgaBackSpace 
    (
    register VGA_CON_DEV *	pVgaConDv	 
    )
    {

    if (pVgaConDv->autoWrap || pVgaConDv->ncol > 0)
	{
	pVgaConDv->col--;
	pVgaConDv->curChrPos -= 2;
	}
    if (pVgaConDv->col < 0)
	{
	pVgaConDv->col = pVgaConDv->ncol - 1;
	pVgaConDv->row--;
	pVgaConDv->scrollCheck = 1;
	}
    }

 






static void vgaTab 
    (
    register VGA_CON_DEV *	pVgaConDv	 
    )
    {
    int			ix;

    for (ix = pVgaConDv->col + 1; ix < 80; ix++)
	{
	if (pVgaConDv->tab_stop [ix])
	    {
	    pVgaConDv->col = ix;
	    break;
	    }
	}
    if (pVgaConDv->autoWrap && ix >= 80)
	{
	pVgaConDv->col = 0;
	pVgaConDv->row++;
	pVgaConDv->scrollCheck = 1;
	}
    pVgaConDv->curChrPos = ( pVgaConDv->memBase + 
			    pVgaConDv->row * pVgaConDv->ncol * 2 + 
			    pVgaConDv->col * 2) ;
    }

 






static void vgaLineFeed 
    (
    register VGA_CON_DEV *	pVgaConDv	 
    )
    {
    pVgaConDv->curChrPos += pVgaConDv->ncol * 2;
    pVgaConDv->row++;
    pVgaConDv->scrollCheck = 1;

    }

 






static void vgaCursorPos 
    (
    register UINT16 pos			 
    )
    {

    sysOutByte ((int) (UCHAR *) 0x3d4, 0x0e);
    sysOutByte ((int) (UCHAR *) 0x3d5, (pos >> 8) & 0xff);
    sysOutByte ((int) (UCHAR *) 0x3d4, 0x0f);
    sysOutByte ((int) (UCHAR *) 0x3d5, pos & 0xff);
    return;
    }

 






static void vgaCursorOn (void)
    {
    sysOutByte ((int) (UCHAR *) 0x3d4, 0x0a);
    sysOutByte ((int) (UCHAR *) 0x3d5, curSt & ~0x20);
    sysOutByte ((int) (UCHAR *) 0x3d4, 0x0b);
    sysOutByte ((int) (UCHAR *) 0x3d5, curEd);
    return;
    }

 






static void vgaCursorOff (void)
    {
    sysOutByte ((int) (UCHAR *) 0x3d4, 0x0a);
    sysOutByte ((int) (UCHAR *) 0x3d5, 0x20);
    sysOutByte ((int) (UCHAR *) 0x3d4, 0x0b);
    sysOutByte ((int) (UCHAR *) 0x3d5, 0x00);
    return;
    }

 
# 735 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c"

int vgaWriteString
    (
    register PC_CON_DEV *	pPcCoDv	 
    )
    {
    int			dummy;
    UCHAR		ch;
    register int		nBytes;
    register UCHAR		atr;
    register RING_ID        ringId = pPcCoDv->tyDev.wrtBuf;
    register VGA_CON_DEV *	pVgaConDv = pPcCoDv->vs;
    
    pPcCoDv->tyDev.wrtState.busy = 1;
    atr = pVgaConDv->curAttrib;
    nBytes = 0;
    
     

    if (pPcCoDv->tyDev.wrtState.xoff || pPcCoDv->tyDev.wrtState.flushingWrtBuf)
	{
    	pPcCoDv->tyDev.wrtState.busy = 0;
	return nBytes;
	}

    while ((						    dummy = (ringId)->pFromBuf,			    ((ringId)->pToBuf == dummy) ?			0 					    :							(						*&ch = (ringId)->buf[dummy],			(ringId)->pFromBuf = ((++ dummy == (ringId)->bufSize) ? 0 : dummy), 	1						)					    ) != 0)
        {
	nBytes++;		 

	 
	
	if ( (pVgaConDv->escFlags == 0x0001) && (pVgaConDv->charSet [ch]
						     != 0))
	    {
	    *(UINT16 *)pVgaConDv->curChrPos = (atr << 8) + 
		                                  pVgaConDv->charSet [ch];
	    if (pVgaConDv->col == pVgaConDv->ncol - 1)
		{ 
		if (pVgaConDv->autoWrap)
		    { 
		    vgaCarriageReturn (pVgaConDv);	 
		    vgaLineFeed (pVgaConDv);
		    goto VGA_CHECK;		 
		    }
		}
	    else
		{
		pVgaConDv->col++;
		pVgaConDv->curChrPos += 2;
		continue;
		}
	    }

	switch (ch)
	    {
	    case 0x07:		 
	         vgaConBeep (0);
		 continue;
	    
	    case 0x08:		 
		 vgaBackSpace (pVgaConDv);
		 continue;

            case '\t':		 
		 vgaTab (pVgaConDv);
		 continue;

            case '\n':		 
		 if ((pPcCoDv->tyDev.options & 0x02) == 0x02)
		    vgaCarriageReturn (pVgaConDv);
		 vgaLineFeed (pVgaConDv);
		 goto VGA_CHECK;

            case 0x0b:		 
		 vgaLineFeed (pVgaConDv);
		 goto VGA_CHECK;

            case 0x0c:		 
		 vgaClear (pVgaConDv, 2, ' ');
		 continue;

	    case 0x0d:		 
		 vgaCarriageReturn (pVgaConDv);
		 continue;



	    case 0x1b:		 
		 pVgaConDv->escFlags = 0x0002;
		 continue; 

            case 0x9b:		 
		 pVgaConDv->escFlags = 0x0004;
		 continue;


	    case 0x0e:		 
		 pVgaConDv->charSet = vgaCharTable [1];
		 continue;

            case 0x0f:		 
		 pVgaConDv->charSet = vgaCharTable [0];
		 continue;

	    case 0x7f:		 
		 vgaDelLeftChar (pVgaConDv);
		 continue;
	  }


	switch (pVgaConDv->escFlags)
	    {
	    int 	ix;	 

	    case 0x0002:
	            pVgaConDv->escFlags = 0x0001;
		    switch (ch)
			{
			case '[':	 
				pVgaConDv->escFlags = 0x0004;
				continue;

			case 'E':	 
				vgaCarriageReturn (pVgaConDv);
				vgaLineFeed (pVgaConDv);
				goto VGA_CHECK;

			case 'M':	 
				pVgaConDv->row --;
				vgaPutCursor (pVgaConDv);
				continue;
				
			case 'D':	 
				vgaLineFeed (pVgaConDv);
				goto VGA_CHECK;

			case 'H':	 
				vgaTab (pVgaConDv);
				continue;
				
			case 'Z':	 
				vgaEscResponse (pPcCoDv,2);
				continue;
				
			case '7':	 
				vgaSaveCurAttrib (pVgaConDv);
				continue;
				
			case '8':	 
				vgaRestAttrib (pVgaConDv);
				continue;
				
			case '(':	 
				pVgaConDv->escFlags = 0x0080;
				continue;
				
			case ')':	 
				pVgaConDv->escFlags = 0x0100;
				continue;
				
			case '#':	 
				pVgaConDv->escFlags = 0x0040;
				continue;
				
			case 'c':	 
				pPcCoDv->ks->kbdHook (0);
				vgaStatInit ();
				vgaClear (pVgaConDv, 2, ' ');
				vgaCursorOn ();
				continue;

			case '>':	 
				pPcCoDv->ks->kbdFlags |= 0x0002;
				pPcCoDv->ks->kbdHook (1);
				continue;

			case '=':	 
				pPcCoDv->ks->kbdFlags &= ~0x0002;
				pPcCoDv->ks->kbdHook (1);
				continue;
           		}
		    continue;

	    case 0x0004:	 
	            for (ix = 0; ix < 16; ix++)
		        pVgaConDv->escPara [ix] = 0;
		    pVgaConDv->escParaCount = 0;
	            pVgaConDv->escFlags = 0x0008;
		    if ( ch == '[')
			{
			pVgaConDv->escFlags = 0x0020;
			continue;
			}

	             

		    if ( (pVgaConDv->escQuestion = (ch == '?')) )
		       continue;

	    case 0x0008:	 
		    if ( (ch == ';') && (pVgaConDv->escParaCount < 16 -1))
			{
			pVgaConDv->escParaCount++;
			continue;
			}
		    else if (ch >= '0' && ch <= '9')
			{
			pVgaConDv->escPara[pVgaConDv->escParaCount] *= 10;
			pVgaConDv->escPara[pVgaConDv->escParaCount] += ch -'0';
			continue;
			}
		    else
		        pVgaConDv->escFlags = 0x0010;

	    case 0x0010:
		    pVgaConDv->escFlags = 0x0001;
		    switch (ch)
			{
			case 'h':	 
			        vgaSetMode (pPcCoDv, 1);
				continue;
				
			case 'l':	 
				vgaSetMode (pPcCoDv, 0);
				continue;

			case 'n':
				if (!pVgaConDv->escQuestion)
				    {
				    if (pVgaConDv->escPara [0] == 5)
					{  
					vgaEscResponse (pPcCoDv,1);
					}
				    else if ( pVgaConDv->escPara [0] == 6)
					{  
					vgaEscResponse (pPcCoDv,0);
					}
				    continue;
				    }
			}
		    if (pVgaConDv->escQuestion) 
			{
			pVgaConDv->escQuestion = 0;
			continue;
			}
		    switch (ch)
			{
			case 'G':	 
			        if (pVgaConDv->escPara [0] > 0)
				    pVgaConDv->escPara [0]--;

				pVgaConDv->col = pVgaConDv->escPara [0];
				vgaPutCursor (pVgaConDv);
				continue;

			case 'A':	 
			        if (pVgaConDv->escPara [0] == 0)
				    pVgaConDv->escPara [0]++;

				pVgaConDv->row -= pVgaConDv->escPara [0];
				vgaPutCursor (pVgaConDv);
                                continue;

			case 'B':	 
			        if (pVgaConDv->escPara [0] == 0)
				    pVgaConDv->escPara [0]++;

				pVgaConDv->row += pVgaConDv->escPara [0];
				vgaPutCursor (pVgaConDv);
				continue;
				
			case 'C':	 
			        if (pVgaConDv->escPara [0] == 0)
				    pVgaConDv->escPara [0]++;

				pVgaConDv->col += pVgaConDv->escPara [0];
				vgaPutCursor (pVgaConDv);
				continue;

			case 'D':	 
			        if (pVgaConDv->escPara [0] == 0)
				    pVgaConDv->escPara [0]++;

				pVgaConDv->col -= pVgaConDv->escPara [0];
				vgaPutCursor (pVgaConDv);
				continue;

			case 'E':	 
			        if (pVgaConDv->escPara [0] == 0)
				    pVgaConDv->escPara [0]++;

				pVgaConDv->row += pVgaConDv->escPara [0];
				pVgaConDv->col = 0;
				vgaPutCursor (pVgaConDv);
				continue;

			case 'F':	 
			        if (pVgaConDv->escPara [0] == 0)
				    pVgaConDv->escPara [0]++;

				pVgaConDv->row -= pVgaConDv->escPara [0];
				pVgaConDv->col = 0;
				vgaPutCursor (pVgaConDv);
				continue;

			case 'd':	 
			        if (pVgaConDv->escPara [0] > 0)
				    pVgaConDv->escPara [0]--;

				pVgaConDv->row = pVgaConDv->escPara [0];
				vgaPutCursor (pVgaConDv);
				continue;
				
			case 'H':	 
                        case 'f':	 
			        if (pVgaConDv->escPara [0] > 0)
				    pVgaConDv->escPara [0]--;

			        if (pVgaConDv->escPara [1] > 0)
				    pVgaConDv->escPara [1]--;

				pVgaConDv->row = pVgaConDv->escPara [0];
				pVgaConDv->col = pVgaConDv->escPara [1];
				vgaPutCursor (pVgaConDv);
				continue;

			case 'J':	 
				vgaClear (pVgaConDv, pVgaConDv->escPara [0],
					  ' ');
				continue;
				
			case 'K':	 
				vgaClearLine (pVgaConDv);
				continue;
			   
			case 'L':	 
				vgaInsertLine (pVgaConDv);
				continue;
				
			case 'M':	 
				vgaDelLines (pVgaConDv);
				continue;

			case 'P':	 
				vgaDelRightChars (pVgaConDv, 
						  pVgaConDv->escPara [0]);
				continue;
				
			case 'c':	 
				if ( pVgaConDv->escPara [0] == 0 )
				    vgaEscResponse (pPcCoDv,2);

				continue;

			case 'g':	 
				if ( pVgaConDv->escPara [0] == 0 )
				    {
				    vgaTab (pVgaConDv);
				    }
				else if ( pVgaConDv->escPara [0] == 3)
				    {
				    pVgaConDv->tab_stop [0] = 0; 
				    pVgaConDv->tab_stop [1] = 0;
				    pVgaConDv->tab_stop [2] = 0;
				    pVgaConDv->tab_stop [3] = 0;
				    pVgaConDv->tab_stop [4] = 0;
				    }
				continue;
				
			case 'm':	 
				vgaSetAttrib (pVgaConDv);
				continue;

			case 'r':	 
				if (pVgaConDv->escPara [0] == 0)
				    pVgaConDv->escPara [0]++;

				if (pVgaConDv->escPara [1] == 0)
				    pVgaConDv->escPara[1] = pVgaConDv->ncol-1;

				if ((pVgaConDv->escPara [0] < 
				    pVgaConDv->escPara [1]) && 
				    (pVgaConDv->escPara [1] < pVgaConDv->ncol))
				    {
				    pVgaConDv->scst = pVgaConDv->escPara [0] -
				    		      1;
				    pVgaConDv->sced = pVgaConDv->escPara [1];
				    pVgaConDv->row = 0;
				    vgaPutCursor (pVgaConDv);
				    }
				continue;
				
			case 's':	 
				vgaSaveCurAttrib (pVgaConDv);
				continue;

			case 'u':	 
				vgaRestAttrib (pVgaConDv);
				continue;

			case '@':	 
				vgaInsertChar (pVgaConDv, 
					       pVgaConDv->escPara [0]);
				continue;
			}
		    
		    continue;

	    case 0x0020:
		    pVgaConDv->escFlags = 0x0001;
		    continue;

	    case 0x0040:
		    pVgaConDv->escFlags = 0x0001;
		    if ( ch == '8' )
		       vgaClear (pVgaConDv, 2, 'E');	 
		    continue;
		    
	    case 0x0080:
	    case 0x0100:
		    if ( ch == 'O' )
		       pVgaConDv->charSet = vgaCharTable [1];
		    else if ( ch == 'B')
			{
			pVgaConDv->charSet = vgaCharTable [0];
			pVgaConDv->escFlags = 0x0001;
			}
		    else if ( ch == 'U')
			{
			pVgaConDv->charSet = vgaCharTable [2];
			pVgaConDv->escFlags = 0x0001;
			}
		    continue;

	    default:
		    pVgaConDv->escFlags = 0x0001;
	    }


	VGA_CHECK:	 
	    {
	    if (pVgaConDv->scrollCheck && pVgaConDv->curChrPos >= 
		pVgaConDv->memBase + pVgaConDv->ncol * 2 * (pVgaConDv->sced 
							      + 1))
		{ 
		 
		
		pVgaConDv->row = pVgaConDv->sced;
		vgaScroll (pVgaConDv, pVgaConDv->row, pVgaConDv->scrollCheck,
			   1, pVgaConDv->defAttrib);
		while (pVgaConDv->curChrPos >= pVgaConDv->memBase + 
		       pVgaConDv->ncol * 2 * (pVgaConDv->sced + 1))
		pVgaConDv->curChrPos -= pVgaConDv->ncol * 2;
		}
	    else if (pVgaConDv->scrollCheck && pVgaConDv->curChrPos < 
		     pVgaConDv->memBase + pVgaConDv->col * 2 * 
		     pVgaConDv->scst)
		{
		 

		pVgaConDv->row = pVgaConDv->scst;
		vgaScroll (pVgaConDv, pVgaConDv->row, pVgaConDv->scrollCheck,
			   0, pVgaConDv->defAttrib);
		while (pVgaConDv->curChrPos < pVgaConDv->memBase + 
		       pVgaConDv->col * 2 * pVgaConDv->scst)
		pVgaConDv->curChrPos += pVgaConDv->ncol * 2;
		}
	    else if (pVgaConDv->curChrPos > pVgaConDv->memBase + 
		     pVgaConDv->ncol * 2 * pVgaConDv->nrow)
		{ 
		 

		while (pVgaConDv->curChrPos > pVgaConDv->memBase + 
		       pVgaConDv->ncol * 2 * pVgaConDv->nrow)
		    {
		    pVgaConDv->curChrPos -= pVgaConDv->ncol * 2;
		    pVgaConDv->row--;
		    }
		}
	    else if (pVgaConDv->curChrPos < pVgaConDv->memBase)
		{ 
		 

		while (pVgaConDv->curChrPos < pVgaConDv->memBase)
		    {
		    pVgaConDv->curChrPos += pVgaConDv->ncol * 2;
		    pVgaConDv->row++;
		    }
		}
	    }	 

	 

	if ((intContext()) && (nBytes >= jobaddThreshold))
	    {
	    excJobAdd ((VOIDFUNCPTR)vgaWriteString, (int)pPcCoDv, 0,0,0,0,0);
	    return (nBytes);
	    }
	}	 

    vgaCursorPos ((pVgaConDv->curChrPos - pVgaConDv->memBase) / 2 );
    pPcCoDv->tyDev.wrtState.busy = 0;

     

    
    if (rngFreeBytes (ringId) >= tyWrtThreshold)
            {
            semGive (&pPcCoDv->tyDev.wrtSyncSem);
            if (_func_selWakeupAll != ((void *)0))
                (* _func_selWakeupAll) (&pPcCoDv->tyDev.selWakeupList, 
					SELWRITE);
	    }
    return nBytes;	 
    }


    
 
# 1262 "d:/Tornado2.2/target/src/drv/serial/m6845Vga.c"

static void vgaEscResponse
    (
    register PC_CON_DEV *	pPcCoDv,	 
    int			responseId	 
    )
    {
    register VGA_CON_DEV *	pVgaConDv;	 
    pVgaConDv = pPcCoDv->vs;
    tyIoctl (&pPcCoDv->tyDev, 26, 0);
    if ( responseId == 0)
	{
	sprintf (pVgaConDv->escResp, "\033[%d;%dR",pVgaConDv->row, 
		 pVgaConDv->col );
	}
    else if ( responseId == 1) 
	{
	sprintf (pVgaConDv->escResp, "\033[0n");
	}
    else if ( responseId == 2)
	{
	sprintf (pVgaConDv->escResp, "\033[?1;0c");
	}
    else
	{
	pVgaConDv->escResp[0] = '\0';
	}
    
    rngBufPut (pPcCoDv->tyDev.rdBuf, pVgaConDv->escResp, 
	       strlen (pVgaConDv->escResp) );
    semGive (&pPcCoDv->tyDev.rdSyncSem);
    selWakeupAll (&pPcCoDv->tyDev.selWakeupList, SELREAD);

    }

 







static void vgaSaveCurAttrib 
    (
    register VGA_CON_DEV *	pVgaConDv	 
    )
    {
    pVgaConDv->sv_rev       = pVgaConDv->rev;
    pVgaConDv->sv_col       = pVgaConDv->col;
    pVgaConDv->sv_row       = pVgaConDv->row;
    pVgaConDv->sv_curAttrib = pVgaConDv->curAttrib;

    }
    
 







static void vgaRestAttrib 
    (
    register VGA_CON_DEV *	pVgaConDv	 
    )
    {
    pVgaConDv->rev       = pVgaConDv->sv_rev;
    pVgaConDv->col       = pVgaConDv->sv_col;
    pVgaConDv->row       = pVgaConDv->sv_row;
    pVgaConDv->curAttrib = pVgaConDv->sv_curAttrib;
    
    }

 






static void vgaSetAttrib 
    (
    register VGA_CON_DEV *	pVgaConDv	 
    )  
    {
    register int		ix;	 
    register UCHAR		attr;	 
    
    attr = pVgaConDv->curAttrib;
    for (ix = 0 ; ix <= pVgaConDv->escParaCount; ix++)
	{
	switch (pVgaConDv->escPara [ix])
	    {
	    case 0:
	          attr =  (0x07   | 0x08) | 0x10;
		  break;
		  
            case 1:
		  attr |= 0x08;		 
		  break;
	       
	    case 4:
		  if (!pVgaConDv->colorMode)
		      {
		      attr |= 0x01;
		      }
		  break;
		  
	    case 5:
		  attr |= 0x80;		 
		  break;

	    case 7:
		  pVgaConDv->rev = 1;  
		  attr = (attr & 0x88) | (((attr >> 4) | ((attr << 4) & 0x7)));
		  break;
		  
	    case 21:
	    case 22:
		  attr &= ~0x08;		 
		  break;
		  
	    case 24:
		  if (!pVgaConDv->colorMode)
		      {
		      attr &= ~0x01;	 
		      }
		  break;
		  
	    case 25:
		  attr &= ~0x80;
		  break;

	    case 27:
		  pVgaConDv->rev = 0; 	 
		  break;

	    default:		
		   

		  if ((pVgaConDv->escPara [ix] >= 30) && 
		      (pVgaConDv->escPara [ix] <= 37) )
		      {
		      attr = (attr & 0xf8) | 
		             (vgaColorTable [pVgaConDv->escPara [ix] - 30]) ;
		      }
		  else if ((pVgaConDv->escPara [ix] >= 40) &&
			   (pVgaConDv->escPara [ix] <= 47))
		      {
		      attr = (attr & 0x8f) |
		             vgaColorTable [pVgaConDv->escPara [ix] - 40] << 4;
		      }
		  break;
            }
	}
    pVgaConDv->curAttrib = attr;    
    }

 






static void vgaSetMode
    (
    register  PC_CON_DEV *	pPcCoDv,	 
    BOOL         	onOff		 
    )
    {
    register int		ix;
    register VGA_CON_DEV *	pVgaConDv;	 
    
    pVgaConDv = pPcCoDv->vs;
    for ( ix =0; ix <= pVgaConDv->escParaCount; ix++ )
	{
	if ( pVgaConDv->escQuestion )
	    {
	    switch (pVgaConDv->escPara [ix])
		{  
		case 1:
		      pPcCoDv->ks->curMode = (onOff) ?  0 : 1;
		      break;
		      
                case 3:  
		      vgaClear (pVgaConDv, 2, ' ');
		      break;
		      
                case 5:
		      pVgaConDv->rev = (pVgaConDv->rev) ? 0 : 1;
		      vgaScreenRev (pVgaConDv);
		      break;
		      
                case 7:
		      pVgaConDv->autoWrap = onOff;
		      break;
		      
                case 25:
		      (onOff) ?  vgaCursorOn() : vgaCursorOff() ;
		      break;
		}
	    }
	else if ( pVgaConDv->escPara [ix] == 4)
	    {
	    pVgaConDv->insMode = onOff;
	    }
	}
    }

 






static void vgaPutCursor 
    (
    register VGA_CON_DEV *	pVgaConDv	 
    )
    {
    if ( pVgaConDv->col  < 0)
	pVgaConDv->col = 0;

    else if (pVgaConDv->col >= pVgaConDv->ncol)
	pVgaConDv->col = pVgaConDv->ncol - 1;

    if ( pVgaConDv->row < pVgaConDv->scst)
	pVgaConDv->row = pVgaConDv->scst;

    else if ( pVgaConDv->row >= pVgaConDv->sced )
	pVgaConDv->row = pVgaConDv->sced;
	    
    pVgaConDv->curChrPos = (pVgaConDv->memBase + pVgaConDv->row *
			    pVgaConDv->ncol * 2 + pVgaConDv->col * 2 );
    
    }

 






static void vgaClearLine 
    (
    register VGA_CON_DEV *	pVgaConDv	 
    )
    {
    register UINT16 *	cp;	 
    register UINT16 *	end;	 
    register UINT16		erase;	 

    erase = (pVgaConDv->defAttrib << 8 ) + ' ';
    
    if (pVgaConDv->escPara [0] == 0 )
	{
	cp  = (UINT16 *) (pVgaConDv->curChrPos + 2 );
	end = (UINT16 *) (pVgaConDv->memBase + pVgaConDv->row  * 
			  pVgaConDv->ncol * 2 + (pVgaConDv->ncol - 1) * 2);
	}
    else if (pVgaConDv->escPara [0] == 1)
	{
	cp  = (UINT16 *) (pVgaConDv->memBase + pVgaConDv->row * 
			 pVgaConDv->ncol * 2);
	end = (UINT16 *) (pVgaConDv->curChrPos);
	}
    else 
	{
	cp  = (UINT16 *) (pVgaConDv->memBase + pVgaConDv->row * 
			  pVgaConDv->ncol * 2);
	end = (UINT16 *) (cp + (pVgaConDv->ncol - 1) * 2);
	pVgaConDv->curChrPos = (UCHAR *) cp ;
	pVgaConDv->col = 0;
	}
    for (; cp <= end; cp ++)
	{
	*cp = erase;
	}
    }

 







static void vgaInsertLine 
    (
    register VGA_CON_DEV *	pVgaConDv	 
    )
    {
    int			ix;
    int			start;
    int			end;

    start = pVgaConDv->scst;
    end   = pVgaConDv->sced;
    pVgaConDv->scst = pVgaConDv->row;
    pVgaConDv->sced = pVgaConDv->nrow - 1 ;
    ix = pVgaConDv->escPara [0];
    if (pVgaConDv->escPara [0] == 0)
	{
	ix = 1;
	}
    if (pVgaConDv->row + ix >= pVgaConDv->nrow)
	{
	ix = pVgaConDv->nrow - pVgaConDv->row - 1;
	}
    vgaScroll (pVgaConDv, pVgaConDv->row, ix, 0, pVgaConDv->defAttrib);
    pVgaConDv->curChrPos -= pVgaConDv->col * 2;
    pVgaConDv->col = 0;
    pVgaConDv->scst = start;
    pVgaConDv->sced = end ;
    
    }
     
 







static void vgaDelLines 
    (
    register VGA_CON_DEV *	pVgaConDv	 
    )
    {
    int			ix;
    int			start;
    int			end;

    start = pVgaConDv->scst;
    end = pVgaConDv->sced;
    pVgaConDv->scst = pVgaConDv->row;
    pVgaConDv->sced = pVgaConDv->nrow - 1;
    ix = pVgaConDv->escPara [0];
    if (ix == 0)
	{
	ix = 1;
	}
    if (pVgaConDv->row + ix > pVgaConDv->nrow) 
	{
	ix = pVgaConDv->row;
	}
    vgaScroll (pVgaConDv, pVgaConDv->sced, ix, 1, pVgaConDv->defAttrib);
    pVgaConDv->curChrPos -= pVgaConDv->col * 2;
    pVgaConDv->col = 0;
    pVgaConDv->scst = start;
    pVgaConDv->sced = end;

    }

 






static void vgaDelRightChars
    (
    register VGA_CON_DEV *	pVgaConDv,	 
    int			nDelChar	 
    )
    {
    register int		xPos;	 
    register UINT16 *	cp;	 
    register UINT16		erase;	 
    
    erase = (pVgaConDv->defAttrib << 8 ) + ' ';

    if (nDelChar + pVgaConDv->col  >=  pVgaConDv->ncol )
	{
	nDelChar = pVgaConDv->ncol - pVgaConDv->col - 1;
	}
    else if (nDelChar == 0)
	{
	nDelChar = 1;
	}
    while ( nDelChar-- )
	{
	xPos = pVgaConDv->col;
	cp   = (unsigned short *) pVgaConDv->curChrPos;
	while (++xPos < pVgaConDv->ncol)
	    {
	    *cp = *(cp +1);
	    cp++;
	    }
	*cp =  erase;            
	}
    }



# 52 "sysSerial.c" 2

# 1 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c" 1
 

 
# 1 "d:/Tornado2.2/target/h/copyright_wrs.h" 1
 

# 5 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c" 2

 
# 17 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c"

 
# 61 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c"

 



# 1 "d:/Tornado2.2/target/h/ioLib.h" 1
 

 

 
# 89 "d:/Tornado2.2/target/h/ioLib.h"


# 343 "d:/Tornado2.2/target/h/ioLib.h"


# 67 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c" 2
# 1 "d:/Tornado2.2/target/h/iosLib.h" 1
 

 

 
# 36 "d:/Tornado2.2/target/h/iosLib.h"


# 131 "d:/Tornado2.2/target/h/iosLib.h"

# 68 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c" 2




# 1 "config.h" 1
 

 

 
# 145 "config.h"

 





# 762 "config.h"






# 73 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c" 2



 

extern PC_CON_DEV	pcConDv [(2)] ;


 

int			kbdIntCnt = 0;
int			kbdTimeoutCnt = 0;
BOOL			kbdTimeout = 0;


 

static WDOG_ID		kbdWdid;
static int		kbdWdsec = 2;
static KBD_CON_DEV	kbdConDv;	 
static UCHAR		oldLedStat = 0;
static BOOL		kbdAcknowledge = 0;
static unsigned	char enhancedKeys[] =   
    {
    0x1c,    
    0x1d,    
    0x35,    
    0x37,    
    0x38,    
    0x46,    
    0x47,    
    0x48,    
    0x49,    
    0x4b,    
    0x4d,    
    0x4f,    
    0x50,    
    0x51,    
    0x52,    
    0x53     
    };


 

static UCHAR action [144] =
    {  
    0,   0,   0,   0,   0,   0,   0,   0,  
   0,   0,   0,   0,   0,   0,   0,   0,  
   0,   0,   0,   0,   0,   0,   0,   0,  
   0,   0,   0,   0,   0,   2,   0,   0,  
   0,   0,   0,   0,   0,   0,   0,   0,  
   0,   0,   1,   0,   0,   0,   0,   0,  
   0,   0,   0,   0,   0,   0,   1,   0,  
   0,   0,   4,   0,    0,    0,    0,     0,  
    0,   0,    0,    0,    0,    3,   5,   7,  
   7,   7,   7,   7,   7,   7,   7,   7,  
   7,   7,   7,   7,   0,    0,    0,     0,  
    0,   0,    0,    0,    0,    0,    0,     0,  
    0,   0,    0,    0,    0,    0,    0,     0,  
    0,   0,    0,    0,    0,    0,    0,     0,  
   0,   0,    0,    0,   0,    0,    0,    0,  
    0,   0,   0,    0,    0,    0,   0,     0,  
   0,   2,   0,   0,   0,   5,   6,   6,  
   0,   6,   6,   0,   6,   0,   6,   6   
    };

 
static UCHAR keyMap [2][4][144] =
    { 
    {  
    {  
    0,  0x1b,   '1',   '2',   '3',   '4',   '5',   '6',	 
  '7',   '8',   '9',   '0',   '-',   '^',  0x08,  '\t',	 
  'q',   'w',   'e',   'r',   't',   'y',   'u',   'i',	 
  'o',   'p',   '@',   '[',  '\r',   2,    'a',   's',	 
  'd',   'f',   'g',   'h',   'j',   'k',   'l',   ';',	 
  ':',     0,   1,    ']',   'z',   'x',   'c',   'v',	 
  'b',   'n',   'm',   ',',   '.',   '/',   1,    '*',	 
  ' ',   ' ',   4,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,   3,    5,    '7',	 
  '8',   '9',   '-',   '4',   '5',   '6',   '+',   '1',	 
  '2',   '3',   '0',   '.',     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
  ' ',     0,     0,  '\\',     0,     0,   ' ',     0,	 
    0,   ' ',     0,     0,     0,  '\\',     0,     0,	 
  '\r',   2,   '/',   '*',   ' ',    5,    'F',   'A',  
    0,   'D',   'C',     0,   'B',     0,    '@',   'P'   
    },
    {  
    0,  0x1b,   '!',   '"',   '#',   '$',   '%',   '&',	 
 '\'',   '(',   ')',     0,   '=',   '~',  0x08,  '\t',	 
  'Q',   'W',   'E',   'R',   'T',   'Y',   'U',   'I',	 
  'O',   'P',   '`',   '{',  '\r',   2,    'A',   'S',	 
  'D',   'F',   'G',   'H',   'J',   'K',   'L',   '+',	 
  '*',     0,   1,    '}',   'Z',   'X',   'C',   'V',	 
  'B',   'N',   'M',   '<',   '>',   '?',   1,    '*',	 
  ' ',   ' ',   4,      0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,   3,    5,    '7',	 
  '8',   '9',   '-',   '4',   '5',   '6',   '+',   '1',	 
  '2',   '3',   '0',   '.',     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
  ' ',     0,     0,   '_',     0,     0,   ' ',     0,	 
    0,   ' ',     0,     0,     0,   '|',     0,     0,	 
  '\r',   2,   '/',   '*',   ' ',    5,    'F',   'A',  
    0,   'D',   'C',     0,   'B',     0,    '@',   'P'   
    },
    {  
 0xff,  0x1b,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0x1e,  0xff,  '\t',	 
 0x11,  0x17,  0x05,  0x12,  0x14,  0x19,  0x15,  0x09,	 
 0x0f,  0x10,  0x00,  0x1b,  '\r',   2,  0x01,   0x13,	 
 0x04,  0x06,  0x07,  0x08,  0x0a,  0x0b,  0x0c,  0xff,	 
 0xff,  0xff,   1,   0x1d,  0x1a,  0x18,  0x03,  0x16,	 
 0x02,  0x0e,  0x0d,  0xff,  0xff,  0xff,  1,    0xff,	 
 0xff,  0xff,   4,   0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,   3,   5,    0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0x1f,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0x1c,  0xff,  0xff,	 
  '\r',   2,   '/',   '*',   ' ',    5,  0x0c,  0xff,  
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff   
    },
    {  
    0,  0x1b,   '1',   '2',   '3',   '4',   '5',   '6',	 
  '7',   '8',   '9',   '0',   '-',   '^',  0x08,  '\t',	 
  'q',   'w',   'e',   'r',   't',   'y',   'u',   'i',	 
  'o',   'p',   '@',   '[',  '\r',   2,    'a',   's',	 
  'd',   'f',   'g',   'h',   'j',   'k',   'l',   ';',	 
  ':',     0,   1,    ']',   'z',   'x',   'c',   'v',	 
  'b',   'n',   'm',   ',',   '.',   '/',   1,    '*',	 
  ' ',   ' ',   4,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,   3,    5,    'w',	 
  'x',   'y',   'l',   't',   'u',   'v',   'm',   'q',	 
  'r',   's',   'p',   'n',     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
  ' ',     0,     0,  '\\',     0,     0,   ' ',     0,	 
    0,   ' ',     0,     0,     0,  '\\',     0,     0,	 
  '\r',   2,   '/',   '*',   ' ',    5,    'F',   'A',  
    0,   'D',   'C',     0,   'B',     0,    '@',   'P'   
    }
    },
    {  
    {  
    0,  0x1b,   '1',   '2',   '3',   '4',   '5',   '6',	 
  '7',   '8',   '9',   '0',   '-',   '=',  0x08,  '\t',	 
  'q',   'w',   'e',   'r',   't',   'y',   'u',   'i',	 
  'o',   'p',   '[',   ']',  '\r',   2,    'a',   's',	 
  'd',   'f',   'g',   'h',   'j',   'k',   'l',   ';',	 
 '\'',   '`',   1,   '\\',   'z',   'x',   'c',   'v',	 
  'b',   'n',   'm',   ',',   '.',   '/',   1,    '*',	 
  ' ',   ' ',   4,      0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,   3,    5,    '7',	 
  '8',   '9',   '-',   '4',   '5',   '6',   '+',   '1',	 
  '2',   '3',   '0',   '.',     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
  '\r',   2,   '/',   '*',   ' ',    5,   'F',   'A',  
    0,   'D',   'C',     0,   'B',     0,    '@',  'P'   
    },
    {  
    0,  0x1b,   '!',   '@',   '#',   '$',   '%',   '^',	 
  '&',   '*',   '(',   ')',   '_',   '+',  0x08,  '\t',	 
  'Q',   'W',   'E',   'R',   'T',   'Y',   'U',   'I',	 
  'O',   'P',   '{',   '}',  '\r',   2,    'A',   'S',	 
  'D',   'F',   'G',   'H',   'J',   'K',   'L',   ':',	 
  '"',   '~',   1,    '|',   'Z',   'X',   'C',   'V',	 
  'B',   'N',   'M',   '<',   '>',   '?',   1,    '*',	 
  ' ',   ' ',   4,      0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,   3,    5,    '7',	 
  '8',   '9',   '-',   '4',   '5',   '6',   '+',   '1',	 
  '2',   '3',   '0',   '.',     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
  '\r',   2,   '/',   '*',   ' ',    5,   'F',   'A',  
    0,   'D',   'C',     0,   'B',     0,   '@',   'P'   
    },
    {  
 0xff,  0x1b,  0xff,  0x00,  0xff,  0xff,  0xff,  0xff,	 
 0x1e,  0xff,  0xff,  0xff,  0x1f,  0xff,  0xff,  '\t',	 
 0x11,  0x17,  0x05,  0x12,  0x14,  0x19,  0x15,  0x09,	 
 0x0f,  0x10,  0x1b,  0x1d,  '\r',   2,   0x01,  0x13,	 
 0x04,  0x06,  0x07,  0x08,  0x0a,  0x0b,  0x0c,  0xff,	 
 0xff,  0x1c,   1,   0xff,  0x1a,  0x18,  0x03,  0x16,	 
 0x02,  0x0e,  0x0d,  0xff,  0xff,  0xff,   1,   0xff,	 
 0xff,  0xff,   4,   0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,   3,    5,   0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,	 
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,	 
  '\r',   2,   '/',   '*',   ' ',    5,  0xff,  0xff,  
 0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff,  0xff   
    },
    {  
    0,  0x1b,   '1',   '2',   '3',   '4',   '5',   '6',	 
  '7',   '8',   '9',   '0',   '-',   '=',  0x08,  '\t',	 
  'q',   'w',   'e',   'r',   't',   'y',   'u',   'i',	 
  'o',   'p',   '[',   ']',  '\r',   2,    'a',   's',	 
  'd',   'f',   'g',   'h',   'j',   'k',   'l',   ';',	 
 '\'',   '`',   1,   '\\',   'z',   'x',   'c',   'v',	 
  'b',   'n',   'm',   ',',   '.',   '/',   1,    '*',	 
  ' ',   ' ',   4,      0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,   3,    5,    'w',	 
  'x',   'y',   'l',   't',   'u',   'v',   'm',   'q',	 
  'r',   's',   'p',   'n',     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
    0,     0,     0,     0,     0,     0,     0,     0,	 
  '\r',   2,   '/',   '*',   ' ',    5,   'F',   'A',  
    0,   'D',   'C',     0,   'B',     0,    '@',  'P'   
    }
    }
    };

 

static void	kbdStatInit (void);
static void	kbdConvChar(unsigned char scanCode);
static void	kbdLedSet (void);
static void	kbdNormal (unsigned char scanCode);
static void	kbdShift (unsigned char scanCode);
static void	kbdCtrl (unsigned char scanCode);
static void	kbdNum (unsigned char scanCode);
static void	kbdCaps (unsigned char scanCode);
static void	kbdStp (unsigned char scanCode);
static void	kbdExt (unsigned char scanCode);
static void	kbdEs (unsigned char scanCode);
static void 	(*keyHandler[]) (unsigned char scanCode)  =
    {
    kbdNormal,   kbdShift,   kbdCtrl,   kbdNum,   kbdCaps,
    kbdStp,      kbdExt,     kbdEs
    };
static void	kbdHook (int opCode);
static void	kbdWdog (void);
static STATUS	kbdWrite (char data);
static STATUS	kbdRead (char *data);
static STATUS	kbdCommand (char data);
      void	kbdReset (void);		 

 
# 345 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c"

void kbdHrdInit (void)
    {
    char	temp;

    kbdWdid = wdCreate ();

    do {
	if (kbdTimeoutCnt > 3)		 	
	    break;

	if (kbdTimeout)			 
	    kbdReset ();

        if (kbdCommand (0x60) == (-1))
	    continue;
        if (kbdWrite (0x44) == (-1))
	    continue;

        while (sysInByte (0x64) & 0x01)
	    if (kbdRead (&temp) == (-1))
		break;
    
        if (kbdCommand (0x60) == (-1))
	    continue;
        if (kbdWrite (0x45) == (-1))
	    continue;

        if (kbdCommand (0xae) == (-1))
	    continue;
	} while (kbdTimeout);

    kbdStatInit ();
    } 

 
# 389 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c"

static void kbdStatInit (void)
    {
    int		ix;		 
    UCHAR	stat;

     

    for ( ix = 0; ix < (2); ix++)
	{
	pcConDv [ix].ks = &kbdConDv;		 
	}

    kbdConDv.curMode = 1;	 
    kbdConDv.convertChar = 1;	 
    
     
    
    kbdConDv.kbdMode  = 1; 
    kbdConDv.kbdFlags = 0x0000|0x0002;		 
    kbdConDv.kbdState = 0; 			 
    kbdConDv.kbdHook  = (FUNCPTR) kbdHook;	 
    kbdConDv.currCon  = (0);     	 
    

    stat = (UCHAR) (kbdConDv.kbdFlags & 0x07);

    if (oldLedStat == stat)
	return;
    oldLedStat = stat;

    do {
	if (kbdTimeoutCnt > 3)		 	
	    break;

	if (kbdTimeout)			 
	    kbdReset ();

        if (kbdWrite (0xed) == (-1))
	    continue;

        if (kbdWrite (stat) == (-1))
	    continue;
	} while (kbdTimeout);
    }

 
# 445 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c"

void kbdIntr (void)
    {
    register UCHAR	scanCode;	 

    kbdIntCnt++;

    if (sysInByte (0x64) & 0x01)
        {
	scanCode = sysInByte (0x60);

	 

	if (scanCode == 0xfa) 
	    {
	    kbdAcknowledge = 1;
	    return;
	    }
	if (kbdConDv.convertChar) 
	    kbdConvChar (scanCode);
	else
	    tyIRd (&(pcConDv[kbdConDv.currCon].tyDev), scanCode);
        }
    }

 








static void kbdConvChar 
    (
    UCHAR	scanCode	 
    )
    {
    if (scanCode == 0xe0)
	{
	kbdConDv.kbdFlags |= 0x0020;
	return;
	}

     

    if (((scanCode & 0x80) << 2) == 0x0200)  
       kbdConDv.kbdFlags |=  0x0200;
    else
       kbdConDv.kbdFlags &= ~0x0200;

    if ((scanCode == 0xe1) || (kbdConDv.kbdFlags & 0x0080))
	{
	if (scanCode == 0xe1)
	    {
	    kbdConDv.kbdFlags ^= 0x0200; 	 
	    kbdConDv.kbdFlags ^= 0x0080;  	 
	    }
	return;
	}
    scanCode &= 0x7f;
    if ((kbdConDv.kbdFlags & 0x0020) == 0x0020)
	{
	int 	ix;		

	for (ix = 0; ix < 16; ix++)
	    {
	    if (scanCode == enhancedKeys [ix])
		{
		scanCode = 0x80 + ix;
		ix = -1;
		break;
		}
	    }
	kbdConDv.kbdFlags ^= 0x0020; 	 
	if (ix != -1)
	    {
	    return ; 			 
	    }
	}

     

    (*keyHandler [action [scanCode]]) (scanCode);
    }

 








static void kbdNormal
    (
    UCHAR	scanCode	 
    )
    {
    register UCHAR	chr;
    register int	ix = kbdConDv.currCon;	 

    if ((kbdConDv.kbdFlags & 0x0200) == 0x0000) 
	{
	chr = keyMap [kbdConDv.kbdMode][kbdConDv.kbdState][scanCode];
	if ((chr == 0xff) || (chr == 0x00))
	    {
	    return;
	    }

	 

	if (((kbdConDv.kbdFlags & 0x0004) == 0x0004) && 
	    (chr >= 'a' && chr <= 'z'))
	    { 
	    chr -= 'a' - 'A';
	    } 
	tyIRd (&(pcConDv [ix].tyDev), chr);	 
	}
    }

 








static void kbdShift
    (
    UCHAR	scanCode	 
    )
    {
    if ((kbdConDv.kbdFlags & 0x0200) == 0x0200) 
	{
	kbdConDv.kbdState = 0;
	kbdConDv.kbdFlags &= (~0x0008);
	}
    else
	{
	kbdConDv.kbdState = 1;
	kbdConDv.kbdFlags |= 0x0008;
	}
    }

 








static void kbdCtrl
    (
    UCHAR	scanCode	 
    )
    {
    if ((kbdConDv.kbdFlags & 0x0200) == 0x0200) 
	{
	kbdConDv.kbdState = 0;
	kbdConDv.kbdFlags &= (~0x0010);
	}
    else
	{
	kbdConDv.kbdState = 2;
	kbdConDv.kbdFlags |= 0x0010;
	}
    }

 








static void kbdCaps
    (
    UCHAR	scanCode	 
    )
    {
    if ((kbdConDv.kbdFlags & 0x0200) == 0x0000) 
	{
	kbdConDv.kbdFlags ^= 0x0004;
	kbdLedSet (); 		 
	}
    }

 
# 651 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c"

static void kbdNum
    (
    UCHAR	scanCode	 
    )
    {
    if ((kbdConDv.kbdFlags & 0x0200) == 0x0000) 
	{
	kbdConDv.kbdFlags ^= 0x0002;
	kbdConDv.kbdState = (kbdConDv.kbdFlags & 0x0002) ? 0 : 3;
	kbdLedSet (); 		 
	}
    }

 
# 674 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c"

static void kbdStp
    (
    UCHAR	scanCode	 
    )
    {
    register int	ix = kbdConDv.currCon;	 

    if ((kbdConDv.kbdFlags & 0x0200) == 0x0000) 
	{
	kbdConDv.kbdFlags ^= 0x0001;
	(kbdConDv.kbdFlags & 0x0001) ? tyIRd (&(pcConDv [ix].tyDev),0x13) : 
	                              tyIRd (&(pcConDv [ix].tyDev),0x11);
	kbdLedSet (); 		 
	}
    }

 
# 701 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c"

static void kbdExt
    (
    UCHAR 	scanCode	 
    )
    {
    register UCHAR	chr;
    register int	ix = kbdConDv.currCon;	 

    if ((kbdConDv.kbdFlags & 0x0200) == 0x0000) 
	{
	chr = keyMap [kbdConDv.kbdMode][kbdConDv.kbdState][scanCode];
	tyIRd (&pcConDv [ix].tyDev, 0x1b); 	 
	kbdConDv.curMode ? tyIRd (&pcConDv [ix].tyDev, '[') : 
	                     tyIRd (&pcConDv [ix].tyDev, 'O');
	tyIRd (&pcConDv [ix].tyDev, chr);	
	}
    }

 








static void kbdEs
    (
    UCHAR	scanCode	 
    )
    {
    register UCHAR	chr;
    register int	ix = kbdConDv.currCon;	 

    if ((kbdConDv.kbdFlags & 0x0200) == 0x0000) 
	{
	chr = keyMap [kbdConDv.kbdMode][kbdConDv.kbdState][scanCode];
	if ((kbdConDv.kbdFlags & 0x0002) == 0x0000)
	    {
	    tyIRd (&pcConDv [ix].tyDev, 0x1b);   
	    tyIRd (&pcConDv [ix].tyDev, 'O');
	    }
	tyIRd (&pcConDv [ix].tyDev, chr);
	}
    }

 
# 758 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c"

static void kbdLedSet (void)
    {
    int		ix;
    UCHAR 	stat = 0;

     
    stat = (UCHAR) (kbdConDv.kbdFlags & 0x07);

    if (oldLedStat == stat)
	return;
    oldLedStat = stat;

    for (ix=0; ix<100; ix++)		 
	if ((sysInByte (0x64) & 0x02) == 0)
	    break;

    sysOutByte (0x60, 0xed);		 


    for (ix=0; ix<100; ix++)		 
	if ((sysInByte (0x64) & 0x02) == 0)
	    break;

    sysOutByte (0x60, stat);		 
    }

 
# 796 "d:/Tornado2.2/target/src/drv/serial/i8042Kbd.c"

static void kbdHook
    (
    int opCode		 
    )
    {
    switch (opCode)
	{
	case 0:
	      kbdStatInit ();
	      break;
        case 1:
	      kbdLedSet ();
	      break;
	default:
	      break;
	}
    }
 








static STATUS kbdRead
    (
    char *pData
    )
    {

    kbdTimeout = 0;
    wdStart (kbdWdid, (sysClkRateGet() * kbdWdsec), (FUNCPTR)kbdWdog, 0);

    while (((sysInByte (0x64) & 0x01) == 0) && !kbdTimeout)
	;

    wdCancel (kbdWdid);

    taskDelay (sysClkRateGet () >> 4);

    *pData = sysInByte (0x60);

    return (kbdTimeout ? (-1) : 0);
    }
 








static STATUS kbdWrite
    (
    char data
    )
    {

    kbdTimeout = 0;
    wdStart (kbdWdid, (sysClkRateGet() * kbdWdsec), (FUNCPTR)kbdWdog, 0);

    while ((sysInByte (0x64) & 0x02) && !kbdTimeout)
	;

    wdCancel (kbdWdid);

    sysOutByte (0x60, data);

    return (kbdTimeout ? (-1) : 0);
    }
 








static STATUS kbdCommand
    (
    char command
    )
    {

    kbdTimeout = 0;
    wdStart (kbdWdid, (sysClkRateGet() * kbdWdsec), (FUNCPTR)kbdWdog, 0);

    while ((sysInByte (0x64) & 0x02) && !kbdTimeout)
	;

    sysOutByte (0x64, command);

    while ((sysInByte (0x64) & 0x02) && !kbdTimeout)
	;

    wdCancel (kbdWdid);

    return (kbdTimeout ? (-1) : 0);
    }
 








void kbdReset (void)
    {
    int		ix;

    for (ix=0; ix<100; ix++)		 
	if ((sysInByte (0x64) & 0x02) == 0)
	    break;

    sysOutByte (0x60, 0xff);

    taskDelay (sysClkRateGet () >> 4);

    for (ix=0; ix<100; ix++)		 
	if ((sysInByte (0x64) & 0x02) == 0)
	    break;

    sysOutByte (0x60, 0x60);

    for (ix=0; ix<100; ix++)		 
	if ((sysInByte (0x64) & 0x02) == 0)
	    break;

    sysOutByte (0x60, 0x45);

    for (ix=0; ix<100; ix++)		 
	if ((sysInByte (0x64) & 0x02) == 0)
	    break;

    sysOutByte (0x64, 0xae);

    for (ix=0; ix<100; ix++)		 
	if ((sysInByte (0x64) & 0x02) == 0)
	    break;
    }
 








static void kbdWdog
    (
    void
    )
    {
    kbdTimeout = 1;
    kbdTimeoutCnt++;
    }

# 54 "sysSerial.c" 2






 





 

static I8250_CHAN  i8250Chan[2];

static I8250_CHAN_PARAS devParas[] = 
    {
      {(0x20 + 0x04),0x3f8,1,0x04},
      {(0x20 + 0x03),0x2f8,1,0x03}

# 87 "sysSerial.c"
    };


 
# 102 "sysSerial.c"


void sysSerialHwInit (void)
    {
    int i;

    for (i = 0; i < 2; i++)
        {
	i8250Chan[i].int_vec = devParas[i].vector;
	i8250Chan[i].channelMode = 0;
	i8250Chan[i].lcr =  (devParas[i].baseAdrs + 0x03*devParas[i].regSpace);
	i8250Chan[i].data =  (devParas[i].baseAdrs + 0x00*devParas[i].regSpace);
	i8250Chan[i].brdl = (devParas[i].baseAdrs + 0x00*devParas[i].regSpace);
	i8250Chan[i].brdh = (devParas[i].baseAdrs + 0x01*devParas[i].regSpace);
	i8250Chan[i].ier =  (devParas[i].baseAdrs + 0x01*devParas[i].regSpace);
	i8250Chan[i].iid =  (devParas[i].baseAdrs + 0x02*devParas[i].regSpace);
	i8250Chan[i].mdc =  (devParas[i].baseAdrs + 0x04*devParas[i].regSpace);
	i8250Chan[i].lst =  (devParas[i].baseAdrs + 0x05*devParas[i].regSpace);
	i8250Chan[i].msr =  (devParas[i].baseAdrs + 0x06*devParas[i].regSpace);

	i8250Chan[i].outByte = sysOutByte;
	i8250Chan[i].inByte  = sysInByte;

	if (sysBp)
	    i8250HrdInit(&i8250Chan[i]);
        }

    }
 
# 145 "sysSerial.c"

void sysSerialHwInit2 (void)
    {
    int i;

     

    for (i = 0; i < 2; i++)
        if (i8250Chan[i].int_vec)
	    {
            (void) intConnect (((VOIDFUNCPTR *) ((i8250Chan[i].int_vec) << 3)),
                                i8250Int, (int)&i8250Chan[i] );
	    if (sysBp)
                sysIntEnablePIC (devParas[i].intLevel); 
            }

    }


 
# 174 "sysSerial.c"

SIO_CHAN * sysSerialChanGet
    (
    int channel		 
    )
    {
    if ((channel >= 0) && (channel < 2))
        {
        return ((SIO_CHAN * ) &i8250Chan[channel]);
        }

    return ((SIO_CHAN *) (-1));
    }


